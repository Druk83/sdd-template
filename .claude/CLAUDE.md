# Rules and Constraints for Claude Code

## CRITICAL RULES

### 1. НИКОГДА не использовать эмодзи
**Запрещено использовать эмодзи в:**
- Коде (comments, переменные, строки)
- Файлах (Markdown, README, задачи)
- Сообщениях пользователю
- Git commit messages (если предлагаю текст)

### 2. Секреты и credentials
**Запрещено:**
- Хардкодить секреты, API ключи, пароли в коде
- Коммитить `.env` файлы с реальными значениями
- Логировать sensitive данные

**Правильно:**
- Использовать переменные окружения
- Хранить секреты в `.env.example` как плейсхолдеры
- Добавлять `.env` в `.gitignore`

### 3. ТОЛЬКО пользователь делает git commit/push
**Claude НЕ должен:**
- Создавать коммиты (`git commit`)
- Делать push (`git push`)
- Создавать ветки (`git checkout -b`)
- Делать merge/rebase
- Изменять git историю

**Claude может:**
- Создавать и редактировать файлы
- Запускать `git status`, `git diff` для проверки
- Предлагать текст commit message (без эмодзи)

**Workflow:**
1. Claude создает/редактирует файлы
2. Claude может проверить: `git status`, `git diff`
3. Claude предлагает описание изменений
4. **Пользователь сам делает `git add`, `git commit`, `git push`**

## Communication Style

### Language
- Всегда отвечать на русском языке
- Код и технические термины — на английском
- Названия файлов, переменных, функций — на английском

### Tone
- Краткие и четкие ответы
- Технический язык без лишних восторгов
- Объективность вместо похвалы
- Факты и решения, а не эмоции
- Никогда не использовать "Вы абсолютно правы" или подобные фразы

### Response Format
- Прямые ответы на вопросы
- Структурированная информация (списки, таблицы)
- Примеры кода в блоках ```
- Без эмодзи

## File Operations

### Creating Files
- Создавать файлы только когда это необходимо
- Предпочитать редактирование существующих файлов
- Не создавать .md файлы без явного запроса пользователя
- Использовать абсолютные пути

### Code Comments
- Комментарии на русском языке (код на английском)
- Без эмодзи
- Краткие и по существу
- Только где логика неочевидна

### Naming and Documentation
- Переменные, функции, классы — на английском
- JSDoc/annotations для публичного API — на английском
- JSDoc/annotations для внутреннего кода — на русском
- Type annotations — на английском (это часть кода)
- Файлы — kebab-case: `user-service.ts`, `auth-controller.ts`
- Ветки — type/description: `feature/add-auth`, `fix/login-bug`, `refactor/user-module`

## Error Handling

**При ошибках выполнения команд:**
- Сообщить пользователю о проблеме
- Предложить варианты решения
- Не повторять упавшую команду без изменений

**При отсутствии файла/директории:**
- Проверить правильность пути
- Спросить пользователя о корректном расположении
- Не создавать файлы/директории без подтверждения

**При неоднозначности задачи:**
- Уточнить требования у пользователя
- Не делать предположений о намерениях

## Base Project Documentation

Документация проекта находится в:
- `.requirements/` - шаблоны и методики для написания документации (read-only)
- `docs/` - фактическая документация проекта (требования, сценарии, архитектура)
- `.tasks/` - текущие задачи и планирование
- `.issues/` - текущие проблемы и баги
- `.manifest/` - манифесты инструментов и процессов
- `README.md` - обзор проекта

**При работе с задачами:**
- Читать .requirements/ для понимания шаблонов
- Читать docs/ для фактов проекта
- Проверять .tasks/ для актуальных задач
- Учитывать .issues/ для известных проблем
- Следовать архитектурным решениям из документации

## Project Structure

Перед началом работы прочитай `.project-structure.json` в корне репо.
Он содержит:
- Иерархию основных директорий
- Назначение каждой папки
- Ключевые файлы по функциональности

Используй эту информацию для навигации по коду вместо вызова tools.

**Если файл отсутствует:**
- Спросить пользователя о структуре проекта
- Не пытаться угадывать структуру самостоятельно

## Работа с манифестами

**Приоритет при конфликте:**
1. Локальный манифест в директории компонента (`./<component>/manifest.md`)
2. Глобальный манифест (`.manifest/<name>manifest.md`)
3. Инструкции из этого файла (CLAUDE.md)

**Стек проекта:**
- Определяется из `package.json`, `requirements.txt`, `go.mod` или аналогичных файлов
- При неясности — спросить пользователя

## Работа с Docker

Читай `.manifest/dockermanifest.md` перед работой с Docker.
Коротко: разделение dev/prod, multi-stage, `.dockerignore`, без секретов в образах, фиксированные версии.

## Работа с PDD

Читай `.manifest/pddmanifest.md` когда встречаешь `@todo` в коде или задаче.
Коротко: формат `@todo #TASK-ID:ESTIMATE Описание`, привязка к `.tasks/`.

## Работа с TDD

Читай `.manifest/tddmanifest.md` при работе с тестами.
Коротко: тесты первым где уместно, быстрые unit, стабильные e2e, `make test` локально.

## Remember

1. Никогда не использовать эмодзи
2. Только пользователь делает git commit/push
3. Технический стиль без восторгов
4. Объективные факты вместо похвалы
5. Краткость и четкость
6. Использовать @todo для незавершенного кода (описание на русском)
7. Использовать TDD для написания тестов
8. Использовать PDD для оформления задач в ходе разработки
