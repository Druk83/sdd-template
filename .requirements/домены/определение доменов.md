# Определение доменов в проекте

## 0. Назначение
Этот документ определяет, **как в проекте выделяются домены** (bounded contexts / области ответственности).

Домены фиксируются **до** сценариев и служат основанием для структуры:
- `docs/requirements/сценарии/<domain_slug>/...`

Разделение “правила/данные”:
- `.requirements/**` — **правила и входные материалы этапа** (шаблоны/методика)
- `docs/**` — **фактические результаты этапов** (используются далее как вход)

**Источник истины по доменам после выполнения этапа:**
- `docs/requirements/домены/**` (реестр + карточки доменов)

---

## 1. Допустимые источники для первичного выделения доменов (ТОЛЬКО)
Первичное выделение доменов выполняется **строго** на основании:

1) `docs/requirements/предметная область.md`
2) `docs/requirements/обоснование выбора.md`
3) `docs/requirements/требования/**`

Запрещено выделять домены по:
- предположениям,
- “типовым” доменам,
- внешним шаблонам,
- сценариям (сценарии идут ПОСЛЕ доменов),
- уже сгенерированным сценариям из `docs/requirements/сценарии/**`.

Если данных недостаточно — домен помечается `draft`, а пробел фиксируется в разделе “Пробелы”.

---

## 2. Определение домена (в терминах проекта)

### 2.1 Терминология (Домен vs Bounded Context)

| Термин | Определение | Уровень | Пример |
|--------|-------------|---------|--------|
| **Домен (Domain)** | Высокоуровневая бизнес-область с единым языком и ответственностью | Стратегический | `orders`, `users`, `payments` |
| **Bounded Context (BC)** | Технический подконтекст внутри домена с чёткими границами модели | Тактический | `order-processing`, `order-fulfillment` |

**Правила:**
- Один **домен** может содержать **один или несколько BC**
- Для простых систем: 1 домен = 1 BC (не выделяем подконтексты отдельно)
- Для сложных систем: 1 домен = N BC (разбиваем по ответственности)
- BC определяются **после** доменов, на этапе сценариев (`.requirements/сценарии/ограниченные контексты.md`)

### 2.2 Признаки домена

**Домен** — это область ответственности, в которой:
- есть свой набор терминов/сущностей,
- есть бизнес-функции (кластер требований),
- есть владение данными/инварианты,
- минимизируются пересечения изменений с другими доменами.

---

## 3. Куда сохраняются результаты (выходные артефакты)
Все результаты этапа "Определение доменов" сохраняются **только** в:

- `docs/requirements/домены/`

### 3.1 Реестр доменов (обязателен)
Создаётся файл:
- `docs/requirements/домены/реестр.md`

Содержит список доменов и их статус.

### 3.2 Карточка домена (обязательна для каждого домена)
Для каждого домена создаётся файл:
- `docs/requirements/домены/<domain_slug>.md`

`<domain_slug>` — стабильный идентификатор домена латиницей (пример: `auth`, `billing`, `catalog`).

---

## 4. Формат карточки домена (минимальный)
Каждый домен `docs/requirements/домены/<domain_slug>.md` обязан содержать:

- `slug`: стабильный идентификатор домена
- `title`: человекочитаемое имя
- `type`: `core | supporting | generic`
- `status`: `draft | active | deprecated`
- `scope_in`: что входит в домен (функции/ответственность)
- `scope_out`: что явно НЕ входит
- `actors`: ключевые участники (если явно указаны)
- `owned_data`: какие данные/сущности “владеет” домен (если выводится из требований/данных)
- `requirements_refs`: ссылки на `docs/requirements/требования/**` (пути или ID), которые покрывает домен
- `interfaces`: взаимодействия с другими доменами (если явно следуют из требований)

Если пункт нельзя заполнить из источников — писать `Не определено источниками`.

---

## 5. Процедура выделения доменов (кратко и проверяемо)

### Шаг A. Кандидаты из предметной области
Из `docs/requirements/предметная область.md` выписать:
- ключевые сущности/термины,
- ключевые процессы/цели,
- акторов/роли (если есть),
и сгруппировать по смысловой близости.

### Шаг B. Приоритизация и ограничения
Из `docs/requirements/обоснование выбора.md` извлечь:
- приоритеты/критерии,
- критические ограничения,
и пометить, какие группы ближе к `core`, а какие — `supporting/generic`.

### Шаг C. Кластеризация требований
Из `docs/requirements/требования/**`:
- сгруппировать функциональные требования по “ответственности” и “данным”,
- для каждого кластера определить домен-владелец.

Правило: **каждое требование должно быть отнесено к одному домену**
или помечено как `generic`, если оно относится ко всем.

### Шаг D. Проверка границ
Для каждого домена проверить:
- нет ли “владения всем подряд”,
- нет ли дублирования ответственности.

Если конфликт — домены уточняются или один из них помечается `draft` до уточнения требований.

---

## 6. Правила наименования и стабильности
- `domain_slug` **не меняется** при переименовании `title`.
- В путях и ссылках используем **только slug**.
- Домены в реестре сортируются по `type` и `slug`.

---

## 7. Пробелы и неопределённости (обязательный раздел)
Если по источникам нельзя корректно выделить домены, фиксировать:
- какие требования не кластеризуются,
- какие термины двусмысленны,
- какие границы не определены.

Рекомендуемый выходной файл (если нужно):
- `docs/requirements/домены/gaps.md`

---

## 8. Связь со сценариями
Сценарии формируются **только после** фиксации доменов в:
- `docs/requirements/домены/реестр.md`
- `docs/requirements/домены/<domain_slug>.md`

Для каждого домена создаётся папка сценариев:
- `docs/requirements/сценарии/<domain_slug>/`

Минимальный набор файлов внутри домена описан в:
- `.requirements/сценарии/правила.md`

---

## 9. Запрет на запись в `.requirements/**`
Агентам и автоматическим генераторам запрещено:
- создавать файлы,
- изменять файлы,
- перемещать файлы

внутри `.requirements/**`.

Результаты сохраняются только в `docs/**`.
