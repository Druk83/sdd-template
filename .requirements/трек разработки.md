# Трек разработки технической документации (H5)

> **Важно:** этот файл в `.requirements/**` — **методика** (read-only).
> Определяет последовательность этапов, ссылки на H6 процедуры и краткие входы/выходы.

---

## 0. Основа и уровни документов

**Иерархия документов:** см. `.manifest/hierarchymanifest.md` (hierarchy.H4.1).
- H0: `.claude/CLAUDE.md` или `.github/agents/copilot-instructions.md` или `AGENTS.md`
- H2: `.manifest/*.md`
- H5: `.requirements/*.md` (этот файл)
- H6: процедуры этапов (внутри H5 шаблонов)
- H8: результаты в `docs/requirements/` и `/README.md`

---

## 1. Последовательность этапов

```
ПОДГОТОВКА
    |
    v
[1] Предметная область
    |
    v
[1] завершение: README L0
    |
    v
[2] Обоснование выбора
    |
    v
[3] Требования
    |
    v
[4] Домены
    |
    v
[5] Сценарии
    +-- [5.1] Карта процесса
    +-- [5.2] Каталог мероприятий
    +-- [5.3] Ограниченные контексты
    +-- [5.4] Диаграммы сценариев + Context Map
    |
    v
[6] Структура данных
    |
    v
[7] Архитектура
    +-- [7 BL] Business Layer
    +-- [7 AL] Application Layer
    +-- [7 TL] Technology Layer
    +-- [7.1] Диаграммы ArchiMate
    |
    v
[8] Структура ПО
    |
    v
[9] Тестирование
    |
    v
ФИНАЛ
```

> **Важно:** Подэтапы ([5.1]-[5.4], [7 BL/AL/TL], [7.1]) выполняются ВНУТРИ этапа.
> Каждый подэтап имеет 4 фазы. Переход к следующему этапу - после завершения всех подэтапов.

---

## 2. Идеальная модель выполнения этапа

**Источник:** `.diagrams/последовательность событий.plantuml`.

**Каждый этап выполняется в 4 фазах:**
1) Инициализация (создание скелета артефакта в `docs/requirements/`).
2) Базовый контекст артефакта (очевидные данные из `.source/` и предыдущих этапов).
3) Уточнение у разработчика (вопросы по неясностям/коллизиям).
4) Финализация (этап считается завершенным только после принятия).

**Правило перехода:** без финализации этап не завершен, переход к следующему этапу запрещен.

**Альтернативные ветви (по диаграмме):**
- Фаза 3: "Есть неясности" -> задать вопросы; "Все ясно" -> фаза 3 пропускается.
- Фаза 4: "Принято" -> этап закрыт; "Требуется доработка" -> внести правки и повторить подтверждение.
- Рендеринг ([5.4], [7.1]): "Успешно" -> сохранить PNG рядом с `.plantuml`; "Ошибка" -> сообщить разработчику, исправить/пропустить и повторить рендеринг.

**Применение подходов из .approach/ (см. `.manifest/sddmanifest.md` sdd.H4.16):**
Перед началом каждого этапа:
1. Прочитай `.approach/registry.json`
2. Найди подходы, где `"stages"` содержит номер текущего этапа
3. Для каждого найденного подхода прочитай файл из поля `"file"`
4. Применяй методологию из подходов при выполнении этапа

**Сопутствующие процедуры на каждом этапе:**
- Gap Tracking: `.manifest/gapmanifest.md`
- Чеклисты готовности: `.manifest/sddmanifest.md` (sdd.H4.8) + H6 критерии в шаблонах
- Плейсхолдеры: `.manifest/sddmanifest.md` (sdd.H4.9)

**Точки подтверждения кандидатов (резюме):**
- Базовый контекст: `sddmanifest.md` sdd.H4.4
- Этап [2]: стандарт, методология, паттерн, стек
- Этап [6]: модель хранения, перечень объектов
- Этап [7 BL/AL/TL]: сущности каждого слоя
> Полные правила — в `sddmanifest.md` sdd.H4.10

---

## 3. Детализация этапов (H6 → H8)

### Подготовка (перед этапом [1])
**Процедура:** метапроцесс (см. `.manifest/sddmanifest.md`, `.manifest/gapmanifest.md`, `.manifest/diagramsmanifest.md`, `.manifest/versionmanifest.md`)  
**Входы:** `.source/`, `.manifest/`, `.requirements/трек разработки.md`, `.approach/registry.json`  
**Выходы:** готовность к этапу [1]

### Этап [1]: Предметная область
**Процедура:** `.requirements/предметная область.md` (H6)
**Результат:** `docs/requirements/предметная область.md` (H8)
**Входы:** `.source/`
**Выходы:** глоссарий, акторы, use cases, границы
**Опциональный раздел 2.4:** раздел "Текущие процессы (as-is)" заполняется только если в `.source/` есть описания текущих процессов (brownfield проект). См. `.manifest/sddmanifest.md` (sdd.H4.4а)

### Этап [1] завершение
**Процедура:** `.manifest/readmemanifest.md`  
**Результат:** `/README.md` (H8, L0)  
**Входы:** результаты этапа [1]  
**Выходы:** README L0

### Этап [2]: Обоснование выбора
**Процедура:** `.requirements/обоснование выбора.md` (H6)  
**Результат:** `docs/requirements/обоснование выбора.md` (H8)  
**Входы:** результаты [1], ограничения, NFR  
**Выходы:** стек, методология, стандарт, обоснования

### Этап [3]: Требования
**Процедуры:** `.requirements/требования/требования_гост*.md` (H6)  
**Результат:** `docs/requirements/требования/` (H8)  
**Входы:** результаты [1], [2], ТЗ/договор  
**Выходы:** FR-*, NFR-*, требования к данным/интерфейсам

### Этап [4]: Домены
**Процедура:** `.requirements/домены/определение доменов.md` (H6)
**Подходы:** `.approach/ddd-patterns.md` (если DDD выбран на [2])
**Результат:** `docs/requirements/домены/реестр.md` + карточки (H8)
**Входы:** результаты [1], [3]
**Выходы:** домены, границы, зависимости

### Этап [5]: Сценарии
**Процедуры:** `.requirements/сценарии/*.md` (H6)
**Подходы:** `.approach/event-storming.md`, `.approach/context-map.md`, `.approach/ddd-patterns.md`
**Результат:** `docs/requirements/сценарии/<domain>/` (H8)
**Входы:** `docs/requirements/домены/реестр.md`, результаты [3]
**Выходы:** карта процесса, каталог мероприятий, ограниченные контексты

### Этап [5.1]: Карта процесса
**Процедура:** `.requirements/сценарии/карта процесса.md` (H6)  
**Результат:** `docs/requirements/сценарии/<domain_slug>/карта процесса.md` (H8)  
**Входы:** результаты [4], [3]  
**Выходы:** карта процесса, события, агрегаты

### Этап [5.2]: Каталог мероприятий
**Процедура:** `.requirements/сценарии/каталог мероприятий.md` (H6)
**Подходы:** `.approach/pub-sub.md` (если Pub/Sub выбран на [2])
**Результат:** `docs/requirements/сценарии/<domain_slug>/каталог мероприятий.md` (H8)
**Входы:** результаты [5.1]
**Выходы:** EVT-*, CMD-*

### Этап [5.3]: Ограниченные контексты
**Процедура:** `.requirements/сценарии/ограниченные контексты.md` (H6)  
**Результат:** `docs/requirements/сценарии/<domain_slug>/ограниченные контексты.md` (H8)  
**Входы:** результаты [4], [5.2]  
**Выходы:** BC границы, связи

### Этап [5.4]: Диаграммы сценариев + Context Map
**Процедуры:** `.requirements/сценарии/диаграммы*.md` (H6)  
**Результат:** `docs/requirements/сценарии/<domain>/diagrams/` (H8)  
**Входы:** результаты [5.1–5.3]  
**Выходы:** UC-*.plantuml, context-map.plantuml + PNG  
**Рендеринг:** `.tools/plantuml-render/README.md`  
**Шаги рендеринга:**  
1) Запустить `.tools/plantuml-render/plantuml-render` для `docs/requirements/сценарии/<domain>/diagrams/`.  
2) Убедиться, что PNG рядом с `.plantuml` созданы/обновлены.  
**Ошибки рендеринга:**  
- Сообщить разработчику текст ошибки и контекст.  
- Исправить диаграммы или согласовать пропуск, затем повторить рендеринг.

### Этап [6]: Структура данных
**Процедуры:** `.requirements/структура Данных/*.md` (H6)
**Подходы:** `.approach/cqrs.md`, `.approach/event-sourcing.md` (если выбраны на [2])
**Результат:** `docs/requirements/структура Данных/` (H8)
**Входы:** результаты [2], [5]
**Выходы:** модель хранения, объекты данных, карточки, ERD

### Этап [7]: Архитектура
**Процедуры:** `.requirements/архитектура/*.md` (H6)
**Подходы:** `.approach/archimate.md` (всегда), `.approach/cqrs.md`, `.approach/pub-sub.md` (если выбраны на [2]), архитектурный паттерн из arch-patterns
**Результат:** `docs/requirements/архитектура/` (H8)
**Входы:** результаты [2], [5], [6]
**Выходы:** BL, AL, TL слои, связи, сущности

### Этап [7 BL]: Business Layer
**Процедура:** `.requirements/архитектура/описание BL.md` (H6)  
**Результат:** `docs/requirements/архитектура/описание BL.md` (H8)  
**Входы:** результаты [2], [5], [6]  
**Выходы:** сущности и связи BL

### Этап [7 AL]: Application Layer
**Процедура:** `.requirements/архитектура/описание AL.md` (H6)  
**Результат:** `docs/requirements/архитектура/описание AL.md` (H8)  
**Входы:** результаты [2], [5], [6]  
**Выходы:** сущности и связи AL

### Этап [7 TL]: Technology Layer
**Процедура:** `.requirements/архитектура/описание TL.md` (H6)  
**Результат:** `docs/requirements/архитектура/описание TL.md` (H8)  
**Входы:** результаты [2], [5], [6]  
**Выходы:** сущности и связи TL

### Этап [7.1]: Диаграммы ArchiMate
**Процедура:** `.requirements/архитектура/диаграммы ArchiMate.md` (H6)  
**Результат:** `docs/requirements/архитектура/diagrams/` (H8)  
**Входы:** результаты [7]  
**Выходы:** BL.plantuml, AL.plantuml, TL.plantuml + PNG  
**Рендеринг:** `.tools/plantuml-render/README.md`  
**Шаги рендеринга:**  
1) Запустить `.tools/plantuml-render/plantuml-render` для `docs/requirements/архитектура/diagrams/`.  
2) Убедиться, что PNG рядом с `.plantuml` созданы/обновлены.  
**Ошибки рендеринга:**  
- Сообщить разработчику текст ошибки и контекст.  
- Исправить диаграммы или согласовать пропуск, затем повторить рендеринг.

### Этап [8]: Структура ПО
**Процедуры:** `.requirements/структура ПО/*.md` (H6)  
**Результат:** `docs/requirements/структура ПО/` (H8)  
**Входы:** результаты [2], [7]  
**Выходы:** стек, файловая структура, зависимости, порты

### Этап [9]: Тестирование
**Процедуры:** `.requirements/тестирование/*.md` (H6)  
**Результат:** `docs/requirements/тестирование/` (H8)  
**Входы:** результаты [3], [5], [7]  
**Выходы:** стратегия тестирования, план испытаний, матрица покрытия

### Финал (после этапа [9])
**Процедура:** метапроцесс (см. `.manifest/gapmanifest.md`, `.manifest/versionmanifest.md`, `.manifest/readmemanifest.md`)
**Входы:** `docs/requirements/gap-tracking.md`, `/README.md`, результаты этапов [1-9]
**Выходы:** закрытые GAP, обновленный `/README.md` с полной информацией из всех этапов

**Обновление README на ФИНАЛ:**
1. Собрать информацию из всех завершенных этапов [1-9]
2. Обновить описание проекта (из [1])
3. Добавить ключевые возможности (из [1], [2], [3])
4. Добавить архитектурные решения (из [7])
5. Добавить технологический стек (из [2], [8])
6. Обновить ссылки на `docs/requirements/`
7. Обновить версию согласно `.manifest/versionmanifest.md`

---

## 4. Навигация и зависимости

### 4.1 Карта связей документов

```
Шаблон                              Читает из                  Пишет в
-----------------------------------------------------------------------------
предметная область.md         ->     .source/              ->   глоссарий, акторы, UC
обоснование выбора.md         ->     [1]                   ->   стек, стандарт, методология
требования_гост*.md           ->     [1], [2]              ->   FR-*, NFR-*
определение доменов.md        ->     [1], [3]              ->   домены, BC
карта процесса.md             ->     [4]                   ->   события, агрегаты
каталог мероприятий.md        ->     [5.1]                 ->   EVT-*, CMD-*
ограниченные контексты.md     ->     [4], [5.1]            ->   BC границы
описание БД.md                ->     [5]                   ->   таблицы, индексы
описание BL/AL/TL.md          ->     [5], [6]              ->   сущности слоя
стек проекта.md               ->     [2], [7]              ->   технологии
стек тестов.md                ->     [3], [8]              ->   стратегия тестов
```

---

## 5. Ссылки на правила и инструменты (H2)

**Манифесты:**
- Правила SDD: `.manifest/sddmanifest.md`
- Gap Tracking: `.manifest/gapmanifest.md`
- Диаграммы: `.manifest/diagramsmanifest.md`
- Версионирование шаблонов: `.manifest/versionmanifest.md`
- Иерархия документов: `.manifest/hierarchymanifest.md`

**Подходы:**
- Event Storming: `.approach/event-storming.md`
- Context Map: `.approach/context-map.md`
- ArchiMate: `.approach/archimate.md`
- DDD Patterns: `.approach/ddd-patterns.md`
- Реестр подходов: `.approach/registry.json`

**Инструменты:**
- Рендеринг PlantUML: `.tools/plantuml-render/README.md`
