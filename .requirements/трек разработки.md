# Трек разработки технической документации (H5)

> **Важно:** этот файл в `.requirements/**` — **методика** (read-only).
> Определяет последовательность создания документации по шаблонам.

---

## 0. Принцип работы

> **Правила поведения агента** описаны в:
> - `.claude/CLAUDE.md` — общие правила (верификация, git, стиль)
> - `.manifest/sddmanifest.md` — правила SDD (пошаговое выполнение, остановки, placeholder'ы, подтверждения)
>
> Этот документ содержит **последовательность этапов и ссылки на H6 процедуры**.

---

## 0.1 Инструменты SDD

| Инструмент | Манифест | Когда нужен |
|------------|----------|-------------|
| Gap Tracking | `.manifest/gapmanifest.md` | Все этапы — фиксация пробелов |
| Диаграммы | `.manifest/diagramsmanifest.md` | [5.4], [7.1] — при создании диаграмм |
| Рендеринг | `.tools/plantuml-render/` | [5.4], [7.1] — после создания .plantuml |
| Версионирование | `.manifest/versionmanifest.md` | При изменении шаблонов |

---

## 1. Последовательность чтения файлов-шаблонов для агента

**Агент ДОЛЖЕН читать файлы в следующем порядке:**

| Этап | Файл шаблона | Результат |
|------|--------------|-----------|
| **Подготовка** | `.requirements/трек разработки.md` | Прочитать этот файл целиком |
| **[1]** | `.requirements/предметная область.md` | `docs/requirements/предметная область.md` |
| **[1] завершение** | — | Создать `/README.md` (L0) согласно `.manifest/readmemanifest.md` |
| **[2]** | `.requirements/обоснование выбора.md` | `docs/requirements/обоснование выбора.md` |
| **[3]** | `.requirements/требования/требования_гост*.md` | `docs/requirements/требования/` |
| **[4]** | `.requirements/домены/определение доменов.md` | `docs/requirements/домены/реестр.md` + карточки |
| **[5.1-5.3]** | `.requirements/сценарии/*.md` | `docs/requirements/сценарии/<domain>/` |
| **[5.4]** | `.requirements/сценарии/диаграммы*.md` | `docs/requirements/сценарии/<domain>/diagrams/` |
| **[6]** | `.requirements/структура Данных/*.md` | `docs/requirements/структура Данных/` |
| **[7]** | `.requirements/архитектура/*.md` | `docs/requirements/архитектура/` |
| **[7.1]** | `.requirements/архитектура/диаграммы ArchiMate.md` | `docs/requirements/архитектура/diagrams/` |
| **[8]** | `.requirements/структура ПО/*.md` | `docs/requirements/структура ПО/` |
| **[9]** | `.requirements/тестирование/*.md` | `docs/requirements/тестирование/` |

---

## 2. Последовательность этапов

> **Примечание:** этапы с пометкой `(*)` имеют **точки подтверждения кандидатов** — агент формулирует перечень сущностей и ожидает подтверждения разработчика перед детальной работой.

```
    Базовый контекст (*)
         |
         v
[1] Предметная область
         |
         v
[2] Обоснование выбора (*)
         |
         v
[3] Требования
         |
         v
[4] Домены
         |
         v
[5] Сценарии
         |
         v
    [5.1] Карта процесса
         |
         v
    [5.2] Каталог мероприятий
         |
         v
    [5.3] Ограниченные контексты
         |
         v
    [5.4] Диаграммы сценариев + Context Map
         |
         v
[6] Структура данных (*)
         |
         v
[7] Архитектура
         |
         v
    [7 BL] Business Layer (*)
         |
         v
    [7 AL] Application Layer (*)
         |
         v
    [7 TL] Technology Layer (*)
         |
         v
    [7.1] Диаграммы ArchiMate
         |
         v
[8] Структура ПО
         |
         v
[9] Тестирование
```

### Точки подтверждения кандидатов

| Этап | Что подтверждается | Где процедура |
|------|--------------------|---------------|
| Базовый контекст | Название, определение, цель, аудитория | `sddmanifest.md` sdd.H4.4 |
| [2] | Стандарт, методология, паттерн, стек | `обоснование выбора.md` |
| [6] | Модель хранения, перечень объектов | `структура Данных/описание БД.md` |
| [7 BL/AL/TL] | Сущности слоя | `архитектура/описание *.md` |

---

## 3. Детализация этапов

### Этап [1]: Предметная область

**Действие:** Прочитай процедуру, извлеки данные из `.source/`, заполни шаблон, сохрани результат.
**Читай:** `.requirements/предметная область.md`
**Пиши:** `docs/requirements/предметная область.md`

| Вход | Выход |
|------|-------|
| `.source/` (интервью, регламенты, договоры) | Глоссарий, акторы, use cases, границы |

**Инструменты:** Gap Tracking
**Финализация:** Создай `/README.md` (L0) по `readmemanifest.md`
**Блокирует:** все последующие этапы

---

### Этап [2]: Обоснование выбора

**Действие:** Прочитай процедуру, выбери стек/методологию/стандарт на основе [1] и ограничений, обоснуй выбор.
**Читай:** `.requirements/обоснование выбора.md`
**Пиши:** `docs/requirements/обоснование выбора.md`

| Вход | Выход |
|------|-------|
| [1], ограничения, NFR | Стек, методология, стандарт, обоснования |

**Инструменты:** Gap Tracking
**Подтверждение:** Стек, стандарт, методология, паттерн
**Блокирует:** [6], [7], [8]

---

### Этап [3]: Требования

**Действие:** Прочитай процедуру, формализуй требования из [1], [2] и ТЗ в формате FR-*/NFR-*.
**Читай:** `.requirements/требования/требования_гост*.md`
**Пиши:** `docs/requirements/требования/`

| Вход | Выход |
|------|-------|
| [1], [2], договор/ТЗ | FR-*, NFR-*, требования к данным/интерфейсам |

**Инструменты:** Gap Tracking
**Блокирует:** [5], [7], [9]

---

### Этап [4]: Домены

**Действие:** Прочитай процедуру, выдели домены из [1] и [3], создай реестр и карточки.
**Читай:** `.requirements/домены/определение доменов.md`
**Пиши:** `docs/requirements/домены/реестр.md` + карточки доменов

| Вход | Выход |
|------|-------|
| [1], [3] | Реестр доменов, карточки, границы, зависимости |

**Инструменты:** Gap Tracking
**Блокирует:** [5]

---

### Этап [5]: Сценарии

**Действие:** Для каждого домена из [4] последовательно выполни [5.1], [5.2], [5.3].

**Структура результатов:**
```
docs/requirements/сценарии/<domain_slug>/
  карта процесса.md
  каталог мероприятий.md
  ограниченные контексты.md
```

> `<domain_slug>` берется **только** из `docs/requirements/домены/реестр.md`.
> Если домен отсутствует в реестре, сценарии для него **не создаются**.

**Legacy-режим:** Если существуют общесистемные сценарии без доменного разбиения (`docs/requirements/сценарии/*.md`), они считаются legacy. После появления доменов их нужно разделить по `<domain_slug>/`.

#### [5.1] Карта процесса
**Читай:** `.requirements/сценарии/карта процесса.md`
**Пиши:** `docs/requirements/сценарии/<domain_slug>/карта процесса.md`

#### [5.2] Каталог мероприятий
**Читай:** `.requirements/сценарии/каталог мероприятий.md`
**Пиши:** `docs/requirements/сценарии/<domain_slug>/каталог мероприятий.md`

#### [5.3] Ограниченные контексты
**Читай:** `.requirements/сценарии/ограниченные контексты.md`
**Пиши:** `docs/requirements/сценарии/<domain_slug>/ограниченные контексты.md`

| Вход | Выход |
|------|-------|
| `docs/requirements/домены/реестр.md`, `docs/requirements/домены/<domain_slug>.md`, [3] | Карта процесса, события, команды, агрегаты, BC |

**Инструменты:** Gap Tracking
**Блокирует:** [5.4], [6]

---

### Этап [5.4]: Диаграммы сценариев + Context Map

**Действие:** Прочитай процедуры, создай диаграммы на основе [5.1-5.3], отрендерь через инструмент.
**Читай:** `.requirements/сценарии/диаграммы сценариев.md`, `.requirements/сценарии/диаграммы Context Map.md`
**Пиши:** `docs/requirements/сценарии/<domain>/diagrams/`

| Вход | Выход |
|------|-------|
| [5.1-5.3] | UC-*.plantuml, context-map.plantuml + PNG |

**Инструменты:** Диаграммы (`diagramsmanifest.md`), Рендеринг (`.tools/plantuml-render/`)
**Блокирует:** [6]

---

### Этап [6]: Структура данных

**Действие:** Прочитай процедуры, спроектируй модель данных на основе [2] и [5], создай карточки объектов.
**Читай:** `.requirements/структура Данных/описание БД.md`, `.requirements/структура Данных/шаблоны карточек.md`
**Пиши:** `docs/requirements/структура Данных/описание БД.md`, `docs/requirements/структура Данных/tables/*.md`

| Вход | Выход |
|------|-------|
| [2], [5] | Карта хранилищ, объекты данных, карточки, ERD |

**Инструменты:** Gap Tracking
**Подтверждение:** Модель хранения, перечень объектов
**Блокирует:** [7]

---

### Этап [7]: Архитектура

**Действие:** Прочитай процедуры, опиши три слоя ArchiMate последовательно: BL, затем AL, затем TL.
**Читай:** `.requirements/архитектура/описание BL.md`, `описание AL.md`, `описание TL.md`, `описание связи TL AL BL.md`
**Пиши:** `docs/requirements/архитектура/BL.md`, `AL.md`, `TL.md`, `связи.md`

| Вход | Выход |
|------|-------|
| [2], [5], [6] | BL, AL, TL слои, связи, сущности |

**Инструменты:** Gap Tracking
**Подтверждение:** Сущности каждого слоя (BL, AL, TL отдельно)
**Блокирует:** [7.1], [8]

---

### Этап [7.1]: Диаграммы ArchiMate

**Действие:** Прочитай процедуру, создай PlantUML диаграммы для каждого слоя, отрендерь.
**Читай:** `.requirements/архитектура/диаграммы ArchiMate.md`
**Пиши:** `docs/requirements/архитектура/diagrams/BL.plantuml`, `AL.plantuml`, `TL.plantuml`

| Вход | Выход |
|------|-------|
| [7] (готовность >= 80%) | BL.plantuml, AL.plantuml, TL.plantuml + PNG |

**Инструменты:** Диаграммы (`diagramsmanifest.md`), Рендеринг (`.tools/plantuml-render/`)
**Блокирует:** [8]

---

### Этап [8]: Структура ПО

**Действие:** Прочитай процедуры, опиши технический стек, файловую структуру, зависимости и порты.
**Читай:** `.requirements/структура ПО/стек проекта.md`, `файловая структура проекта.md`, `зависимости.md`, `ports.md`
**Пиши:** `docs/requirements/структура ПО/`

| Вход | Выход |
|------|-------|
| [2], [7] | Стек, файловая структура, зависимости, порты |

**Инструменты:** Gap Tracking
**Блокирует:** реализацию

---

### Этап [9]: Тестирование

**Действие:** Прочитай процедуры, разработай стратегию тестирования и план испытаний.
**Читай:** `.requirements/тестирование/стек тестов.md`, `.requirements/тестирование/испытание системы.md`
**Пиши:** `docs/requirements/тестирование/`

| Вход | Выход |
|------|-------|
| [3], [5], [7] | Стратегия тестирования, план испытаний, матрица покрытия |

**Инструменты:** Gap Tracking
**Блокирует:** релиз

---

## 4. Навигация и зависимости

### 4.1 Карта связей документов

```
Шаблон                              Читает из                  Пишет в
-----------------------------------------------------------------------------
предметная область.md         ->     .source/              ->   глоссарий, акторы, UC
обоснование выбора.md         ->     [1]                   ->   стек, стандарт, методология
требования_гост*.md           ->     [1], [2]              ->   FR-*, NFR-*
определение доменов.md        ->     [1], [3]              ->   домены, BC
карта процесса.md             ->     [4]                   ->   события, агрегаты
каталог мероприятий.md        ->     [5.1]                 ->   EVT-*, CMD-*
ограниченные контексты.md     ->     [4], [5.1]            ->   BC границы
описание БД.md                ->     [5]                   ->   таблицы, индексы
описание BL/AL/TL.md          ->     [5], [6]              ->   сущности слоя
стек проекта.md               ->     [2], [7]              ->   технологии
стек тестов.md                ->     [3], [8]              ->   стратегия тестов
```

---

## 5. Чеклист готовности этапа

**Общий чеклист (для всех этапов):**

- [ ] Шаблон скопирован в `docs/requirements/`
- [ ] Все обязательные секции заполнены
- [ ] Ссылки на предыдущие этапы актуальны
- [ ] Открытые вопросы зафиксированы в `gap-tracking.md`
- [ ] Верификация релевантности выполнена (термины из `.source/`)

**Минимальные критерии по этапам:**

| Этап | Минимум для перехода |
|------|---------------------|
| [1] | Глоссарий >= 5, актор >= 1, UC >= 1 |
| [2] | Стек, стандарт, методология выбраны |
| [3] | FR >= 1, NFR >= 1 |
| [4] | Домен >= 1 с карточкой (детали в H6) |
| [5] | UC >= 1 с событиями (детали в H6) |
| [6] | Таблица/коллекция >= 1 |
| [7] | BL + AL + TL описаны |
| [8] | Стек, файловая структура |
| [9] | Стратегия, тест-кейс >= 1 |

> **Детальные критерии** находятся в соответствующих H6 процедурах.

---

## 6. Правила для агентов

> Полные правила: `.manifest/sddmanifest.md`

**Краткая сводка:**

1. Сформулировать базовый контекст перед этапом [1]
2. Начинать с этапа [1], не пропускать этапы
3. Не галлюцинировать — достраивать или спрашивать
4. Вести Gap Tracking в `docs/requirements/gap-tracking.md`
5. Не редактировать `.requirements/**` (read-only)
6. Останавливаться после каждого этапа
7. Задачи `.tasks/` — только для кода, при SDD используется `gap-tracking.md`

---

## 9. Версионирование шаблонов

> Правила версионирования: `.manifest/versionmanifest.md`
> Текущая версия: `/README.md`

### 9.1 Реестр дат изменений

| Шаблон | Последнее изменение |
|--------|---------------------|
| трек разработки.md | 2026-01-29 |
| предметная область.md | 2026-01 |
| обоснование выбора.md | 2026-01 |
| требования_гост19.md | 2026-01 |
| требования_гост34.md | 2026-01 |
| определение доменов.md | 2026-01 |
| карта процесса.md | 2026-01 |
| каталог мероприятий.md | 2026-01 |
| ограниченные контексты.md | 2026-01 |
| диаграммы сценариев.md | 2026-01 |
| диаграммы Context Map.md | 2026-01 |
| описание БД.md | 2026-01 |
| описание BL.md | 2026-01 |
| описание AL.md | 2026-01 |
| описание TL.md | 2026-01 |
| описание связи TL AL BL.md | 2026-01 |
| сущности архитекутры.md | 2026-01 |
| диаграммы ArchiMate.md | 2026-01 |
| стек проекта.md | 2026-01 |
| файловая структура.md | 2026-01 |
| стек тестов.md | 2026-01 |
| испытание системы.md | 2026-01 |
