# Трек разработки технической документации

> **Важно:** этот файл в `.requirements/**` — **методика** (read-only).
> Определяет последовательность создания документации по шаблонам.

---

## 0. Принцип работы

> **Правила поведения агента** описаны в:
> - `.claude/CLAUDE.md` — общие правила (верификация, git, стиль)
> - `.manifest/sddmanifest.md` — правила SDD (пошаговое выполнение, остановки, placeholder'ы, подтверждения)
>
> Этот документ содержит **последовательность этапов и детализацию шаблонов**.

---

## 1. Последовательность чтения файлов-шаблонов для агента

**Агент ДОЛЖЕН читать файлы в следующем порядке:**

| Этап | Файл шаблона | Действие |
|------|--------------|---------|
| **Подготовка** | `.requirements/трек разработки.md` | Прочитать этот файл целиком (вы его читаете) |
| **[1]** | `.requirements/предметная область.md` | Скопировать структуру в `docs/requirements/предметная область.md`, заполнить фактами |
| **[1] завершение** | — | Создать `/README.md` (L0) согласно `.manifest/readmemanifest.md` |
| **[2]** | `.requirements/обоснование выбора.md` | Скопировать в `docs/requirements/обоснование выбора.md` |
| **[3а]** | `.requirements/требования/требования_гост19.md` | Выбрать подходящий (ГОСТ 19 или ГОСТ 34 или иной, который оговорен в **[1]** и **[2]**) |
| **[3б]** | `.requirements/требования/требования_гост34.md` | Скопировать выбранный в `docs/requirements/требования/` |
| **[4]** | `.requirements/домены/определение доменов.md` | Скопировать в `docs/requirements/домены/реестр.md` + создать карточки доменов |
| **[5.0]** | `.requirements/сценарии/правила.md` | Прочитать правила Event Storming |
| **[5.1]** | `.requirements/сценарии/карта процесса.md` | Скопировать в `docs/requirements/сценарии/<domain>/` для каждого домена |
| **[5.2]** | `.requirements/сценарии/каталог мероприятий.md` | Скопировать в `docs/requirements/сценарии/<domain>/` |
| **[5.3]** | `.requirements/сценарии/ограниченные контексты.md` | Скопировать в `docs/requirements/сценарии/<domain>/` |
| **[5.4]** | `.requirements/сценарии/диаграммы сценариев.md` + `диаграммы Context Map.md` | Построить диаграммы в `docs/requirements/сценарии/<domain>/diagrams/` |
| **[6.0]** | `.requirements/структура Данных/правила проектирования данных.md` | Прочитать правила проектирования |
| **[6]** | `.requirements/структура Данных/описание БД.md` | Скопировать в `docs/requirements/структура Данных/описание БД.md` |
| **[6 шаблоны]** | `.requirements/структура Данных/шаблоны карточек.md` | Использовать для создания карточек объектов данных |
| **[7 BL]** | `.requirements/архитектура/описание BL.md` | Скопировать в `docs/requirements/архитектура/BL.md` |
| **[7 AL]** | `.requirements/архитектура/описание AL.md` | Скопировать в `docs/requirements/архитектура/AL.md` |
| **[7 TL]** | `.requirements/архитектура/описание TL.md` | Скопировать в `docs/requirements/архитектура/TL.md` |
| **[7 связи]** | `.requirements/архитектура/описание связи TL AL BL.md` | Скопировать в `docs/requirements/архитектура/связи.md` |
| **[7 сущности]** | `.requirements/архитектура/сущности архитекутры.md` | Скопировать в `docs/requirements/архитектура/сущности.md` |
| **[7.1]** | `.requirements/архитектура/диаграммы ArchiMate.md` | Построить диаграммы в `docs/requirements/архитектура/diagrams/*.plantuml` |
| **[8 стек]** | `.requirements/структура ПО/стек проекта.md` | Скопировать в `docs/requirements/структура ПО/стек проекта.md` |
| **[8 файловая]** | `.requirements/структура ПО/файловая структура проекта.md` | Скопировать в `docs/requirements/структура ПО/файловая структура.md` |
| **[8 зависимости]** | `.requirements/структура ПО/зависимости.md` | Скопировать в `docs/requirements/структура ПО/зависимости.md` |
| **[8 ports]** | `.requirements/структура ПО/ports.md` | Скопировать в `docs/requirements/структура ПО/ports.md` |
| **[9 тестирование]** | `.requirements/тестирование/стек тестов.md` | Скопировать в `docs/requirements/тестирование/стек тестов.md` |
| **[9 испытание]** | `.requirements/тестирование/испытание системы.md` | Скопировать в `docs/requirements/тестирование/испытание системы.md` |

---

## 2. Последовательность этапов

> **Примечание:** этапы с пометкой `(*)` имеют **точки подтверждения кандидатов** — агент формулирует перечень сущностей и ожидает подтверждения разработчика перед детальной работой.

```
    Базовый контекст (*)
         |
         v
[1] Предметная область
         |
         v
[2] Обоснование выбора (*)
         |
         v
[3] Требования
         |
         v
[4] Домены
         |
         v
[5] Сценарии
         |
         v
    [5.1] Карта процесса
         |
         v
    [5.2] Каталог мероприятий
         |
         v
    [5.3] Ограниченные контексты
         |
         v
    [5.4] Диаграммы сценариев + Context Map
         |
         v
[6] Структура данных (*)
         |
         v
[7] Архитектура
         |
         v
    [7 BL] Business Layer (*)
         |
         v
    [7 AL] Application Layer (*)
         |
         v
    [7 TL] Technology Layer (*)
         |
         v
    [7.1] Диаграммы ArchiMate
         |
         v
[8] Структура ПО
         |
         v
[9] Тестирование
```

### Точки подтверждения кандидатов

| Этап | Что подтверждается | Шаблон |
|------|--------------------|--------|
| Базовый контекст | Название, определение, цель, аудитория | раздел 5.2.3 |
| [2] | Стандарт, методология, паттерн, стек | `обоснование выбора.md` раздел 2.4 |
| [6] | Модель хранения, перечень объектов | `описание БД.md` раздел 2.7 |
| [7 BL] | Business Actors, Objects, Events, Processes | `описание BL.md` раздел 1.8 |
| [7 AL] | Application Components, Interfaces, Events | `описание AL.md` раздел 1.11 |
| [7 TL] | Nodes, System Software, Networks, HA, Backup | `описание TL.md` раздел 1.11 |

---

## 3. Детализация этапов

### Этап 1: Предметная область

**Цель:** понять "что строим и зачем", зафиксировать термины и границы.

| Шаблон | Результат |
|--------|-----------|
| `.requirements/предметная область.md` | `docs/requirements/предметная область.md` |

**Входы:** интервью, регламенты, законы, договоры, AS-IS описания.

**Выходы:**
- Глоссарий терминов
- Участники домена (actors)
- Доменные сущности и правила
- Use Cases (верхнеуровневые)
- Критерии успеха
- `/README.md` (L0) — **завершающий шаг этапа**

**Завершающий шаг: README L0**

После заполнения основных артефактов этапа [1] агент создает `/README.md` в корне проекта.
Содержание согласно `.manifest/readmemanifest.md`, раздел 4.1:
- 1–2 предложения: что за проект
- 3–7 bullets: ключевые возможности
- high-level архитектура (кратко)
- минимальный Quickstart
- ссылки на `docs/requirements/`

**Блокирует:** все последующие этапы (это фундамент).

---

### Этап 2: Обоснование выбора

**Цель:** зафиксировать ключевые технические и методологические решения.

| Шаблон | Результат |
|--------|-----------|
| `.requirements/обоснование выбора.md` | `docs/requirements/обоснование выбора.md` |

**Входы:** предметная область, ограничения (бюджет, сроки, команда), NFR.

**Выходы:**
- Выбор стека (языки, фреймворки, БД)
- Выбор методологии (Event Storming, DDD, etc.)
- Формат диаграмм (mermaid/plantuml)
- Обоснование каждого решения
- Альтернативы и причины отказа

**Блокирует:** структура данных, архитектура, структура ПО.

---

### Этап 3: Требования

**Цель:** формализовать функциональные и нефункциональные требования.

| Шаблон | Результат |
|--------|-----------|
| `.requirements/требования/требования_гост19.md` | `docs/requirements/требования/требования_гост19.md` |
| `.requirements/требования/требования_гост34.md` | `docs/requirements/требования/требования_гост34.md` |

**Входы:** предметная область, обоснование выбора, договор/ТЗ заказчика.

**Выбор шаблона:**
- **ГОСТ 19** — для программных продуктов (библиотеки, CLI, сервисы)
- **ГОСТ 34** — для автоматизированных систем (комплексные решения с оборудованием, инфраструктурой)
- **Иной стандарт** — если проект требует другого стандарта (ISO, IEEE, внутренний регламент):
  1. Зафиксировать выбор стандарта в `docs/requirements/обоснование выбора.md`
  2. Создать шаблон `.requirements/требования/<standard>.md` по аналогии с ГОСТ 19/34
  3. Или адаптировать ближайший существующий шаблон под требуемый стандарт
  4. Результат сохранять в `docs/requirements/требования/<standard>.md` 

**Выходы:**
- Функциональные требования (FR-*)
- Нефункциональные требования (NFR-*)
- Требования к данным
- Требования к интерфейсам
- Требования к документации

**Блокирует:** сценарии, архитектура, тестирование.

---

### Этап 4: Домены

**Цель:** разбить систему на ограниченные контексты (bounded contexts).

| Шаблон | Результат |
|--------|-----------|
| `.requirements/домены/определение доменов.md` | `docs/requirements/домены/реестр.md` + `docs/requirements/домены/<slug>.md` |

**Входы:** предметная область, требования.

**Выходы:**
- Реестр доменов с описанием
- Карточка каждого домена
- Границы ответственности
- Зависимости между доменами

**Блокирует:** сценарии (создаются по доменам).

---

### Этап 5: Сценарии (Event Storming)

**Цель:** описать процессы, события и контексты для каждого домена.

| Шаблон | Результат (для каждого домена) |
|--------|--------------------------------|
| `.requirements/сценарии/карта процесса.md` | `docs/requirements/сценарии/<domain>/карта процесса.md` |
| `.requirements/сценарии/каталог мероприятий.md` | `docs/requirements/сценарии/<domain>/каталог мероприятий.md` |
| `.requirements/сценарии/ограниченные контексты.md` | `docs/requirements/сценарии/<domain>/ограниченные контексты.md` |

**Методика:** `.requirements/сценарии/правила.md`

**Входы:** домены, требования.

**Выходы (для каждого домена):**
- Карта процесса (потоки, этапы, последовательности)
- Каталог мероприятий (события, payload)
- Ограниченные контексты (границы внутри домена)
- Связь с требованиями

**Блокирует:** диаграммы сценариев (подэтап 5.5).

---

### Этап 5.5: Диаграммы сценариев + Context Map

**Цель:** визуализировать сценарии и связи между Bounded Contexts.

| Шаблон | Результат |
|--------|-----------|
| `.requirements/сценарии/диаграммы сценариев.md` | `docs/requirements/сценарии/<domain>/diagrams/UC-XX-sequence.plantuml` |
| | `docs/requirements/сценарии/<domain>/diagrams/UC-XX-activity.plantuml` |
| `.requirements/сценарии/диаграммы Context Map.md` | `docs/requirements/сценарии/<domain>/diagrams/context-map.plantuml` |

**Входы:** карта процесса, ограниченные контексты (BC), Integration Matrix.

**Выходы:**
- Sequence Diagram — взаимодействие участников во времени
- Activity Diagram — поток управления с ветвлениями
- Context Map — связи между Bounded Contexts (DDD)

**Типы связей Context Map:**
- Customer/Supplier (U/D)
- Conformist (CF)
- Anti-Corruption Layer (ACL)
- Open Host Service / Published Language (OHS/PL)
- Shared Kernel (SK)
- Partnership

**Чеклист:**
- [ ] Каждый UC имеет минимум одну диаграмму
- [ ] Context Map содержит все BC из раздела 2
- [ ] Типы связей указаны (U/D, CF, ACL, OHS)
- [ ] Диаграммы рендерятся без ошибок

**Блокирует:** структура данных (агрегаты -> сущности).

---

### Этап 6: Структура данных

**Цель:** описать модель данных и схему хранения.

| Шаблон | Результат |
|--------|-----------|
| `.requirements/структура Данных/описание БД.md` | `docs/requirements/структура Данных/описание БД.md` |

**Методики:**
- `.requirements/структура Данных/правила проектирования данных.md`
- `.requirements/структура Данных/шаблоны карточек.md`

**Входы:** обоснование выбора (тип БД), сценарии (агрегаты, события).

**Выходы:**
- Карта хранилищ
- Перечень объектов данных
- Карточки объектов (`tables/*.md`, `collections/*.md`, etc.)
- Диаграммы (ERD/Class/Component)
- Индексы, ограничения, retention

**Логика:** сценарии дают агрегаты -> агрегаты превращаются в сущности хранения.

**Блокирует:** архитектура (repositories, data access layer).

---

### Этап 7: Архитектура

**Цель:** описать архитектурные слои и их взаимодействие.

| Шаблон | Результат |
|--------|-----------|
| `.requirements/архитектура/описание TL.md` | `docs/requirements/архитектура/TL.md` |
| `.requirements/архитектура/описание AL.md` | `docs/requirements/архитектура/AL.md` |
| `.requirements/архитектура/описание BL.md` | `docs/requirements/архитектура/BL.md` |
| `.requirements/архитектура/описание связи TL AL BL.md` | `docs/requirements/архитектура/связи.md` |
| `.requirements/архитектура/сущности архитекутры.md` | `docs/requirements/архитектура/сущности.md` |

**Входы:** обоснование выбора, сценарии, структура данных.

**Выходы:**
- Technology Layer (инфраструктура, узлы, системное ПО)
- Application Layer (use cases, orchestration)
- Business Layer (domain logic, entities)
- Связи между слоями
- Архитектурные сущности

**Логика:** архитектура проектируется вокруг модели данных (repositories, use cases).

**Блокирует:** диаграммы ArchiMate (подэтап 7.1).

---

### Этап 7.1: Диаграммы ArchiMate

**Цель:** визуализировать архитектуру в формате ArchiMate диаграмм.

| Шаблон | Результат |
|--------|-----------|
| `.requirements/архитектура/диаграммы ArchiMate.md` | `docs/requirements/архитектура/diagrams/BL.plantuml` |
| | `docs/requirements/архитектура/diagrams/AL.plantuml` |
| | `docs/requirements/архитектура/diagrams/TL.plantuml` |

**Входы:** описания BL, AL, TL (готовность >= 80%), сущности архитектуры.

**Выходы:**
- BL.plantuml — Business Layer (акторы, процессы, сервисы, объекты)
- AL.plantuml — Application Layer (компоненты, интерфейсы, данные)
- TL.plantuml — Technology Layer (узлы, устройства, артефакты)

**Порядок построения:**
1. BL -> AL -> TL (снизу вверх по абстракции)
2. Сначала сущности текущего слоя
3. Затем внешние сущности из соседних слоев
4. Связи группировать по типам

**Чеклист:**
- [ ] Цвета соответствуют слоям (желтый/голубой/зеленый)
- [ ] Сущности имеют ID для трассируемости
- [ ] Легенда присутствует
- [ ] Диаграммы рендерятся без ошибок

**Блокирует:** структура ПО.

---

### Этап 8: Структура ПО

**Цель:** описать техническую организацию проекта.

| Шаблон | Результат |
|--------|-----------|
| `.requirements/структура ПО/стек проекта.md` | `docs/requirements/структура ПО/стек проекта.md` |
| `.requirements/структура ПО/файловая структура проекта.md` | `docs/requirements/структура ПО/файловая структура.md` |
| `.requirements/структура ПО/зависимости.md` | `docs/requirements/структура ПО/зависимости.md` |
| `.requirements/структура ПО/ports.md` | `docs/requirements/структура ПО/ports.md` |

**Входы:** обоснование выбора, архитектура.

**Выходы:**
- Технологический стек с версиями
- Файловая структура репозитория
- Зависимости (internal/external)
- Порты и интерфейсы

**Логика:** организация файлов/модулей под архитектуру.

**Блокирует:** реализацию.

---

### Этап 9: Тестирование

**Цель:** описать стратегию и план тестирования.

| Шаблон | Результат |
|--------|-----------|
| `.requirements/тестирование/стек тестов.md` | `docs/requirements/тестирование/стек тестов.md` |
| `.requirements/тестирование/испытание системы.md` | `docs/requirements/тестирование/испытание системы.md` |

**Входы:** требования, сценарии, архитектура.

**Выходы:**
- Стек тестирования (unit/integration/e2e)
- План испытаний
- Критерии приемки
- Матрица покрытия требований

**Блокирует:** релиз.

---

## 4. Навигация и зависимости

### 4.1 Карта связей документов

```
Шаблон                              Читает из                  Пишет в
─────────────────────────────────────────────────────────────────────────
предметная область.md         →     (входные данные)      →   глоссарий, акторы, UC
обоснование выбора.md         →     [1]                   →   стек, стандарт, методология, паттерны
требования_гост*.md           →     [1], [2]              →   FR-*, NFR-*
определение доменов.md        →     [1], [3]              →   домены, BC
карта процесса.md             →     [4]                   →   события, агрегаты
каталог мероприятий.md        →     [5.1]                 →   EVT-*, CMD-*
ограниченные контексты.md     →     [4], [5.1]            →   BC границы
описание БД.md                →     [5]                   →   таблицы, индексы
описание BL/AL/TL.md          →     [5], [6]              →   сущности слоя
описание связи TL AL BL.md    →     [7 BL/AL/TL]          →   связи между слоями
сущности архитекутры.md       →     [7]                   →   каталог сущностей
стек проекта.md               →     [2], [7]              →   технологии
файловая структура.md         →     [7], [8 стек]         →   структура папок
стек тестов.md                →     [3], [8]              →   стратегия тестов
испытание системы.md          →     [3], [9 стек]         →   план испытаний
```

### 4.2 Зависимости между этапами

> См. раздел 2 "Последовательность этапов".

---

## 5. Чеклист готовности этапа

**Общий чеклист (для всех этапов):**
* [ ] Шаблон скопирован в `docs/**`
* [ ] Все обязательные секции заполнены
* [ ] Ссылки на предыдущие этапы актуальны
* [ ] Открытые вопросы зафиксированы
* [ ] Задачи на доработку созданы в `.tasks/`
* [ ] **[1], [5], [6], [7]:** Верификация релевантности выполнена (см. `.claude/CLAUDE.md`, правило 4)

**Критерии готовности по этапам:**

| Этап | Минимум для перехода |
|------|---------------------|
| [1] Предметная область | Глоссарий >= 5 терминов, >= 1 актор, >= 1 Use Case |
| [2] Обоснование выбора | Выбран стек, стандарт, методология моделирования, арх. паттерн |
| [3] Требования | >= 1 FR, >= 1 NFR, приоритеты расставлены |
| [4] Домены | См. детальные критерии ниже |
| [5] Сценарии | См. детальные критерии ниже |
| [5.5] Диаграммы сценариев + Context Map | Для каждого UC: sequence/activity + Context Map для домена |
| [6] Структура данных | >= 1 таблица/коллекция с полями |
| [7] Архитектура | BL + AL + TL описаны, >= 5 связей между слоями |
| [7.1] Диаграммы | BL + AL + TL диаграммы созданы, легенда присутствует |
| [8] Структура ПО | Стек зафиксирован, файловая структура описана |
| [9] Тестирование | Стратегия выбрана, >= 1 тест-кейс на FR |

### 5.1 Детальные критерии этапа [4] Домены

| Критерий | Минимум | Блокирует переход |
|----------|---------|-------------------|
| Реестр доменов | Файл `реестр.md` существует | Да |
| Количество доменов | >= 1 активный домен | Да |
| Карточки доменов | Файл `<slug>.md` для каждого домена | Да |
| scope_in | >= 3 функции/ответственности | Да |
| scope_out | >= 2 исключения с указанием владельца | Да |
| actors | >= 1 актор с описанием роли | Да |
| owned_data | >= 1 сущность с атрибутами | Да |
| requirements_refs | >= 2 ссылки на FR/NFR | Да |
| interfaces | >= 1 связь (если не изолирован) | Нет |
| Покрытие FR | Каждый FR отнесён к домену | Да |

**Ссылка на примеры:** `.requirements/домены/определение доменов.md`, раздел 4.1

### 5.1.1 Детальные критерии этапа [5] Сценарии

**Карта процесса (для каждого домена):**

| Критерий | Минимум | Блокирует переход |
|----------|---------|-------------------|
| UC в домене | >= 1 UC | Да |
| Шаги в UC | >= 5 шагов в Happy Path | Да |
| CMD в UC | >= 2 команды | Да |
| EVT в UC | >= 2 события | Да |
| Lanes | >= 2 участника (Actor + BC) | Да |
| Идентификаторы | correlationId + >= 2 ключевых поля | Да |
| Инварианты (BR) | >= 1 на UC | Да |
| Альтернативы | >= 1 (если есть ветвления) | Нет |
| Агрегаты | >= 1 агрегат в домене | Да |

**Каталог мероприятий (для каждого домена):**

| Критерий | Минимум | Блокирует переход |
|----------|---------|-------------------|
| События | >= 3 события | Да |
| Команды | >= 2 команды | Да |
| Реестр событий | Таблица с 7+ колонками | Да |
| Карточки событий | >= 1 детальная карточка | Да |
| Payload полей | >= 4 поля для ключевых событий | Да |
| Publisher/Subscriber | Указаны для каждого события | Да |

**Ограниченные контексты (для каждого домена):**

| Критерий | Минимум | Блокирует переход |
|----------|---------|-------------------|
| BC в домене | >= 1 BC (или обоснование "домен = 1 BC") | Да |
| Описание BC | >= 5 пунктов (назначение, данные, инварианты, интерфейсы) | Да |
| Данные BC | >= 1 aggregate с атрибутами | Да |
| Context Map | >= 1 связь (если > 1 BC) | Нет |
| Integration Matrix | Таблица для Integration Events | Да |

**Ссылка на примеры:** `.requirements/сценарии/карта процесса.md`, `.requirements/сценарии/каталог мероприятий.md`, `.requirements/сценарии/ограниченные контексты.md`

---

## 5.2 Пошаговое выполнение

> Правила пошагового выполнения, остановки, базового контекста и подтверждения кандидатов
> описаны в `.manifest/sddmanifest.md`, разделы 3-5.

---

## 6. Правила для агентов

> Полные правила поведения агента: `.manifest/sddmanifest.md`, раздел 8.

**Краткая сводка:**
1. Сформулировать базовый контекст перед этапом [1]
2. Начинать с этапа 1, не пропускать этапы
3. Не галлюцинировать — достраивать или спрашивать
4. Вести Gap Tracking в `docs/requirements/gap-tracking.md`
5. Не редактировать `.requirements/**` (read-only)
6. Останавливаться после каждого этапа
7. Задачи `.tasks/` — только для кода, при SDD используется `gap-tracking.md`

---

## 7. Gap Tracking (Трекинг пробелов)

**Цель:** отслеживание незавершенных и неполных артефактов документации.

### 7.1 Реестр пробелов

Агент создает файл `docs/requirements/gap-tracking.md` и ведет таблицу:

| GAP-ID | Этап | Артефакт | Описание пробела | Критичность | Блокирует | Статус | Задача |
|--------|------|----------|------------------|-------------|-----------|--------|--------|
| GAP-001 | [1] | Предметная область | Не определены границы системы | HIGH | [2], [3] | OPEN | TASK-001 |
| GAP-002 | [3] | Требования | Отсутствуют NFR по производительности | MEDIUM | [9] | IN_PROGRESS | TASK-005 |
| GAP-003 | [5] | Сценарии | Не описан happy path для UC-003 | LOW | - | RESOLVED | - |

### 7.2 Критичность пробелов

| Уровень | Описание | Действие |
|---------|----------|----------|
| `HIGH` | Блокирует несколько этапов | Требуется немедленное решение |
| `MEDIUM` | Блокирует 1 этап или влияет на качество | Решить до завершения текущего этапа |
| `LOW` | Не блокирует, но желательно устранить | Можно отложить |

### 7.3 Статусы пробелов

| Статус | Описание |
|--------|----------|
| `OPEN` | Пробел обнаружен, задача не создана |
| `IN_PROGRESS` | Создана задача, работа ведется |
| `BLOCKED` | Решение зависит от внешних факторов |
| `RESOLVED` | Пробел устранен |
| `WONTFIX` | Решено не устранять (с обоснованием) |

### 7.4 Автоматическое выявление пробелов

Агент ДОЛЖЕН проверять на наличие пробелов:

1. **При копировании шаблона:**
   - Секции с `<placeholder>` без значений
   - Ссылки на несуществующие документы
   - Пустые обязательные поля

2. **При переходе к следующему этапу:**
   - Незаполненные входы для следующего этапа
   - Отсутствующие зависимости

3. **При финальной проверке:**
   - Разрывы трассируемости (REQ без UC, UC без теста)
   - Несогласованность между артефактами

### 7.5 Формат записи в gap-tracking.md

```markdown
## Gap Tracking

> Последнее обновление: YYYY-MM-DD

### Статистика
- OPEN: N
- IN_PROGRESS: N
- BLOCKED: N
- RESOLVED: N (за последние 7 дней)

### Открытые пробелы

| GAP-ID | Этап | Артефакт | Описание | Критичность | Блокирует | Задача |
|--------|------|----------|----------|-------------|-----------|--------|
| ... | ... | ... | ... | ... | ... | ... |

### История (RESOLVED/WONTFIX)

| GAP-ID | Дата закрытия | Резолюция |
|--------|---------------|-----------|
| ... | ... | ... |
```

### 7.6 Разграничение gap-tracking и .tasks/

**При SDD (разработка документации):**
- Пробелы фиксируются ТОЛЬКО в `gap-tracking.md`
- Задачи в `.tasks/` НЕ создаются
- Колонка "Задача" в таблице остаётся пустой или содержит `—`

**При разработке кода (после SDD):**
- Задачи создаются в `.tasks/` по формату из `.manifest/taskmanifest.md`
- GAP из документации могут трансформироваться в задачи на код
- Связь: в задаче указывается ссылка на GAP-ID

**Почему так:**
- `gap-tracking.md` — инструмент отслеживания пробелов в документации
- `.tasks/` — инструмент планирования работ по коду (PR, коммиты, тесты)
- Смешивание усложняет оба процесса

---

## 8. Работа с диаграммами

### 8.1 Общие правила

Агент ОБЯЗАН соблюдать следующие правила при работе с диаграммами:

1. **Код диаграммы** сохраняется в отдельный файл `*.plantuml` или `*.mmd` (не inline в markdown)
2. **Рендеринг** выполняется агентом или CI/CD в формат PNG/SVG
3. **Ссылка на изображение** добавляется в markdown-документ
4. **Исходный код** и **картинка** хранятся рядом в папке `diagrams/`

### 8.2 Файловая структура диаграмм

```
docs/requirements/
  diagrams/                           # общие диаграммы предметной области
    domain-overview.plantuml
    domain-overview.png
  сценарии/
    <domain>/
      diagrams/                       # диаграммы конкретного домена
        UC-01-sequence.plantuml
        UC-01-sequence.png
        context-map.plantuml
        context-map.png
  архитектура/
    diagrams/                         # архитектурные диаграммы
      BL.plantuml
      BL.png
      AL.plantuml
      AL.png
      TL.plantuml
      TL.png
```

### 8.3 Именование файлов диаграмм

| Тип диаграммы | Формат имени | Пример |
|---------------|--------------|--------|
| Обзор домена | `<domain>-overview.plantuml` | `domain-overview.plantuml` |
| Sequence (UC) | `UC-<NN>-sequence.plantuml` | `UC-01-sequence.plantuml` |
| Activity (UC) | `UC-<NN>-activity.plantuml` | `UC-01-activity.plantuml` |
| Context Map | `context-map.plantuml` | `context-map.plantuml` |
| ArchiMate слой | `<layer>.plantuml` | `BL.plantuml`, `AL.plantuml`, `TL.plantuml` |
| ERD | `erd-<domain>.plantuml` | `erd-users.plantuml` |

### 8.4 Рендеринг диаграмм

**Вариант A: Локальный рендеринг (рекомендуется)**

```bash
# PlantUML (требуется Java + plantuml.jar)
java -jar plantuml.jar -tpng docs/requirements/diagrams/*.plantuml

# Или через Docker
docker run --rm -v $(pwd):/data plantuml/plantuml -tpng /data/docs/requirements/diagrams/*.plantuml
```

**Вариант B: CI/CD рендеринг**

Добавить шаг в пайплайн:
```yaml
# GitHub Actions пример
- name: Render PlantUML diagrams
  uses: cloudbees/plantuml-github-action@master
  with:
    args: -tpng docs/requirements/**/*.plantuml
```

**Вариант C: Онлайн-сервисы (для быстрого просмотра)**

- PlantUML Server: `http://www.plantuml.com/plantuml/png/~1<encoded>`
- Kroki: `https://kroki.io/plantuml/png/<encoded>`

### 8.5 Вставка диаграмм в документы

После рендеринга агент ОБЯЗАН добавить ссылку на изображение в markdown:

```markdown
### 12.1 Диаграмма событий

<!-- Исходный код: diagrams/domain-events.plantuml -->
![Диаграмма событий домена](diagrams/domain-events.png)
```

**Правила:**
- Комментарий с путём к исходному коду обязателен
- Alt-текст должен быть описательным
- Относительный путь от текущего документа

### 8.6 Чеклист работы с диаграммами

При создании диаграммы агент проверяет:

- [ ] Код сохранён в отдельный `*.plantuml` файл
- [ ] Файл находится в правильной папке `diagrams/`
- [ ] Имя файла соответствует конвенции (раздел 8.3)
- [ ] Диаграмма отрендерена в PNG
- [ ] В markdown добавлена ссылка на PNG
- [ ] Добавлен комментарий с путём к исходному коду
- [ ] Диаграмма рендерится без ошибок (проверить синтаксис)

---

## 9. Версионирование шаблонов

> Правила версионирования: `.manifest/versionmanifest.md`
> Текущая версия: `/README.md`

### 9.1 Реестр дат изменений

| Шаблон | Последнее изменение |
|--------|---------------------|
| трек разработки.md | 2026-01-27 |
| предметная область.md | 2026-01 |
| обоснование выбора.md | 2026-01 |
| требования_гост19.md | 2026-01 |
| требования_гост34.md | 2026-01 |
| определение доменов.md | 2026-01 |
| карта процесса.md | 2026-01 |
| каталог мероприятий.md | 2026-01 |
| ограниченные контексты.md | 2026-01 |
| диаграммы сценариев.md | 2026-01 |
| диаграммы Context Map.md | 2026-01 |
| описание БД.md | 2026-01 |
| описание BL.md | 2026-01 |
| описание AL.md | 2026-01 |
| описание TL.md | 2026-01 |
| описание связи TL AL BL.md | 2026-01 |
| сущности архитекутры.md | 2026-01 |
| диаграммы ArchiMate.md | 2026-01 |
| стек проекта.md | 2026-01 |
| файловая структура.md | 2026-01 |
| стек тестов.md | 2026-01 |
| испытание системы.md | 2026-01 |
