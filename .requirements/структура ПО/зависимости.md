# Инвентаризация зависимостей (Dependencies Inventory) — <PROJECT_NAME>

> **Важно:** этот файл в `.requirements/**` — **шаблон/методика** (read-only).  
> Заполненная (фактическая) инвентаризация хранится в: `docs/requirements/dependencies-inventory.md`.  
> Результаты фиксируются только в `docs/**`, шаблоны не изменяем.

---

## 0. Контекст
- **Проект:** `<PROJECT_NAME>`
- **Дата инвентаризации:** `<YYYY-MM-DD>`
- **Версия документа:** `<vX.Y>`
- **Ответственный:** `<team/person>`

### 0.1 Источники (факты проекта)
- **Стек (документ проекта):** `docs/requirements/структура ПО/стек проекта.md` 
- **Требования (документы проекта):**
  - `docs/requirements/требования/требования_гост19.md`
  - `docs/requirements/требования/требования_гост34.md`
- **Манифесты зависимостей (репозиторий):** `<paths list>`
  - примеры: `package.json`, `Cargo.toml`, `requirements.txt`, `pyproject.toml`, `pom.xml`, `build.gradle`, `go.mod`, `Dockerfile`, `helm/**`, `.github/workflows/**`
- **Методика сбора:** `<как собирали: вручную/скриптом, какие команды (npm ls, cargo tree, pip freeze...)>`

### 0.2 Принципы заполнения
- Никаких “примерных” версий без источника. Если версия неизвестна — ставить `<TBD>` и ссылку на источник.
- Обязательно разделять уровни: `runtime / dev / build / test / ops` (если применимо).
- Отдельно фиксировать: прямые vs транзитивные зависимости, уязвимости, deprecated, EOL/поддержка.
- Везде, где возможно, указывать: **политику pinning** (lock-файл, диапазоны версий, digest для образов).

---

## 1. Сводка (Executive Summary)

### 1.1 Количество и покрытие
- **Компонентов/сервисов:** `<N>`
- **Языков/платформ:** `<Node/Rust/Python/Java/Go/...>`
- **Пакетов (direct):** `<N>` / **транзитивных:** `<N>`
- **Критические зависимости (P1):** `<list short>`

### 1.2 Риски и статус (обязательно)
- **CVE:** `<0 / есть, кратко>`
- **Deprecated:** `<есть/нет>`
- **EOL/End-of-support:** `<есть/нет>`
- **Version drift между сервисами:** `<есть/нет>`

### 1.3 Правила контроля зависимостей (из требований)
- **Ограничения лицензий:** `<MIT/Apache-only/запрет GPL/...>` *(если есть)*
- **Ограничения источников:** `<официальные репозитории/зеркала/...>`
- **Политика обновлений:** `<cadence + критические патчи>`
- **Политика supply-chain:** `<SBOM, pinning, signatures, provenance>`

---

## 2. Матрица компонентов и манифестов
> Что у нас есть и где лежат файлы зависимостей.

| Компонент | Роль | Язык/Runtime | Путь | Манифест(ы) | Lock-файл | Примечания |
|---|---|---|---|---|---|---|
| `<frontend>` | UI | `<TS/Node>` | `<path>` | `package.json` | `package-lock.json` |  |
| `<service-a>` | API | `<Rust>` | `<path>` | `Cargo.toml` | `Cargo.lock` |  |
| `<service-b>` | worker | `<Python>` | `<path>` | `requirements.txt` / `pyproject.toml` | `poetry.lock` / `requirements.lock` |  |
| `<infra>` | ops | `<...>` | `<path>` | `helm/**` / `kustomize/**` | `-` |  |

---

## 3. Node.js / TypeScript (если применимо)

### 3.0 Общие правила Node.js
- **Package manager:** `<npm/pnpm/yarn>` (версия: `<...>`)
- **Node.js:** min `<...>`, rec `<...>`
- **Lock:** `<package-lock.json/pnpm-lock.yaml/yarn.lock>` — обязателен: `<yes/no>`
- **Команды аудита:** `npm audit` / `pnpm audit` / `yarn audit`

### 3.1 Компонент: `<NAME>` (`<path>/package.json`)
| Уровень | Пакет | Версия | Тип (direct/transitive) | Назначение | Источник/заметка |
|---|---|---|---|---|---|
| runtime | `<pkg>` | `<ver>` | direct | `<why used>` | `<note>` |
| dev | `<pkg>` | `<ver>` | direct | `<build/test>` |  |
| build | `<pkg>` | `<ver>` | direct | `<bundler>` |  |
| test | `<pkg>` | `<ver>` | direct | `<tests>` |  |

**Транзитивные (важные/проблемные):**
| Пакет | Пришёл из | Версия | Статус (deprecated/CVE) | Комментарий |
|---|---|---|---|---|
| `<pkg>` | `<parent>` | `<ver>` | `<...>` | `<...>` |

**Аудит и уязвимости:**
- **audit summary:** `<0 / list>`
- **Зафиксированные CVE:**  
  - `<CVE-ID>` — `<severity>` — затрагивает `<pkg>` — действие: `<upgrade/mitigate/accept>`

**Выравнивание версий (если это серия сервисов):**
- `<shared package>`: `<policy: keep same major/minor across services>`

---

## 4. Rust (если применимо)

### 4.0 Общие правила Rust
- **Toolchain:** `<stable/nightly>` / `rust-toolchain.toml` = `<yes/no>`
- **Lock:** `Cargo.lock` — `<required/optional>` (policy: `<...>`)
- **Аудит:** `cargo audit`, `cargo deny` *(если используется)*
- **Дерево:** `cargo tree`

### 4.1 Выровненные зависимости (межсервисно)
> Таблица “единых” библиотек: runtime-критичные и cross-cutting (tokio, serde, tracing, sqlx, etc.)

| Dependency | `<svc1>` | `<svc2>` | `<svc3>` | ... | Примечание |
|---|---:|---:|---:|---|---|
| `tokio` | `<ver>` | `<ver>` | `<ver>` |  | `<policy>` |
| `serde` | `<ver>` | `<ver>` | `<ver>` |  |  |
| `tracing` | `<ver>` | `<ver>` | `<ver>` |  |  |

### 4.2 Компонент: `<NAME>` (`<path>/Cargo.toml`)
| Crate | Версия | Тип (direct/transitive) | Features | Назначение | Риск/заметка |
|---|---|---|---|---|---|
| `<crate>` | `<ver>` | direct | `<features>` | `<why used>` | `<note>` |
| `<crate>` | `<ver>` | direct | `<features>` |  |  |

**Специализированные зависимости:**
- `<crate + why>`
- `<crate + why>`

**Аудит и уязвимости:**
- **cargo audit:** `<0 / list>`
- **Advisories:**  
  - `<RUSTSEC-ID>` / `<CVE>` — `<crate>` — действие: `<upgrade/patch/accept>`

---

## 5. Python (если применимо)

### 5.0 Общие правила Python
- **Python:** min `<...>`, rec `<...>`
- **Менеджер:** `<pip/poetry/uv/pip-tools>` (lock: `<requirements.lock/poetry.lock>`)
- **Аудит:** `pip-audit` / `safety` *(если используется)*
- **Pinning:** `<strict pins/compatible ranges>` *(policy from requirements)*

### 5.1 Компонент: `<NAME>` (`<path>/requirements.txt` / `pyproject.toml`)
| Пакет | Версия | Уровень (runtime/dev/test) | Тип (direct/transitive) | Назначение | Примечание |
|---|---|---|---|---|---|
| `<pkg>` | `<ver>` | runtime | direct | `<why used>` |  |
| `<pkg>` | `<ver>` | dev | direct |  |  |

**Аудит и уязвимости:**
- **pip-audit:** `<0 / list>`
- **CVE:** `<...>`

---

## 6. Java / JVM (если применимо)

### 6.1 Компонент: `<NAME>` (`pom.xml` / `build.gradle`)
| Artifact | Версия | Scope (compile/test/runtime) | Тип | Назначение | Примечание |
|---|---|---|---|---|---|
| `<group:artifact>` | `<ver>` | compile | direct |  |  |

---

## 7. Go (если применимо)

### 7.1 Компонент: `<NAME>` (`go.mod`)
| Module | Версия | Тип | Назначение | Примечание |
|---|---|---|---|---|
| `<module>` | `<ver>` | direct |  |  |

---

## 8. Infra / DevOps / Tooling зависимости (рекомендуется)
> Это “внешние инструменты” и инфраструктура, которые обязательны для сборки/запуска.

### 8.1 Контейнеры и базовые образы
| Компонент | Образ/версия | Роль | Источник | Примечания |
|---|---|---|---|---|
| Runtime image | `<image:tag>` | `<run>` | `<registry>` | `<pin digest?>` |
| Build image | `<image:tag>` | `<build>` | `<registry>` |  |

### 8.2 Инструменты CI/CD
| Инструмент | Версия | Где используется | Назначение | Примечания |
|---|---|---|---|---|
| `<GitHub Actions runner>` | `<...>` | CI | `<...>` |  |
| `<Terraform/Ansible>` | `<...>` | infra | `<...>` |  |

### 8.3 Брокеры/БД/внешние сервисы (как зависимости)
| Сервис | Версия | Роль | Требования | Примечания |
|---|---|---|---|---|
| PostgreSQL | `<...>` | DB | `<HA/backups>` |  |
| Redis | `<...>` | cache/queue | `<persistence?>` |  |
| Kafka | `<...>` | events | `<retention>` |  |

---

## 9. Лицензии и соответствие требованиям (ГОСТ/политики)
> Сопоставление с требованиями проекта:
> - `docs/requirements/требования/требования_гост19.md`
> - `docs/requirements/требования/требования_гост34.md`

### 9.1 Политика лицензий
| Зависимость | Лицензия | Разрешено? | Причина/ссылка на требование | Действие |
|---|---|---:|---|---|
| `<pkg/crate>` | `<MIT/Apache/GPL>` | `yes/no` | `<req-id>` | `<replace/approve>` |

### 9.2 Supply-chain / SBOM
- **SBOM:** `<CycloneDX/SPDX>` — генерируется: `<yes/no>` — путь: `<...>`
- **Подписи/проверка источника:** `<sigstore/GPG/etc>`
- **Политика “pin versions”:** `<...>`

---

## 10. Уязвимости, deprecated, EOL

### 10.1 CVE / Advisories (реестр)
| ID | Severity | Зависимость | Где используется | Статус | План |
|---|---|---|---|---|---|
| `<CVE/RUSTSEC>` | `<critical/high/...>` | `<pkg>` | `<component>` | `<open/fixed/accepted>` | `<ETA/steps>` |

### 10.2 Deprecated
| Зависимость | Причина | Транзитивная? | Замена | План |
|---|---|---:|---|---|
| `<pkg>` | `<deprecated>` | `yes/no` | `<replacement>` | `<...>` |

### 10.3 EOL / End-of-support
| Компонент | Версия | EOL дата | Риск | План |
|---|---|---|---|---|
| `<runtime/db>` | `<ver>` | `<date>` | `<...>` | `<upgrade>` |

---

## 11. Выравнивание версий и стратегия обновлений

### 11.1 Общие зависимости (policy)
- **Версионирование:** `<pin/compatible ranges>`
- **Обновления:** `<monthly/quarterly + security hotfix>`
- **Единые версии для shared libs:** `<list>`

### 11.2 Расхождения (drift)
| Технология | Компонент A | Компонент B | Проблема | Решение |
|---|---|---|---|---|
| `<axios>` | `<1.6>` | `<1.13>` | `<incompat/security>` | `<align to ...>` |

---

## 12. Приложение: как агент должен заполнять
> Мини-чеклист для автоматического формирования документа.

1) Прочитать REQ:STACK (формат пути: `docs/requirements/структура ПО/стек проекта.md`) → извлечь языки/рантаймы/БД/брокеры/фронт/инструменты.  
2) Прочитать `docs/requirements/требования/требования_гост19.md`, `docs/requirements/требования/требования_гост34.md` → извлечь ограничения по лицензиям, обновлениям, безопасности, SBOM.  
3) Для каждого компонента из структуры ПО:
   - Найти манифесты зависимостей и lock-файлы.
   - Выписать direct зависимости (`runtime/dev/build/test`).
   - Отметить общие/критические и расхождения версий.
4) Сформировать разделы 3–8 по факту наличия (если нет Python — раздел пропустить).
5) Заполнить риски: `CVE/deprecated/EOL`; указать статус и план.
6) Обновить “Сводку” и “Стратегию обновлений”.

---

**Последнее обновление:** `<YYYY-MM-DD>`
