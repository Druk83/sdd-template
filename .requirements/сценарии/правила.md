# Правила при формировании сценариев

## 0. Назначение
Этот документ определяет, **как формировать сценарные артефакты по доменам**.

**Выход (результаты сценариев):**
- `docs/requirements/сценарии/**`

**Вход фактов для сценариев (источник истины по доменам):**
- `docs/requirements/домены/реестр.md`
- `docs/requirements/домены/<domain_slug>.md`

**Дополнительный вход для трассировки:**
- `docs/requirements/требования/**`

Домены определяются по методике:
- `.requirements/домены/определение доменов.md`

> Если домен отсутствует в `docs/requirements/домены/реестр.md`, сценарии для него **не создаются**.

---

## 1. Структура сценариев по доменам (обязательная)
Сценарии организуются так:

`docs/requirements/сценарии/<domain_slug>/`
- `карта процесса.md`
- `каталог мероприятий.md`
- `ограниченные контексты.md`

Где `<domain_slug>` берётся **только** из `docs/requirements/домены/реестр.md`.

---

## 2. Минимальный набор артефактов домена (3 файла)
Эти три файла — обязательны для каждого домена:

1) `карта процесса.md`  
   Потоки/этапы/последовательности домена.
   Основание: факты из `docs/домены/<domain_slug>.md` и покрывающие требования.

2) `каталог мероприятий.md`  
   Реестр событий/версий/минимальных payload домена.
   Основание: факты из доменной карточки и покрывающих требований.

3) `ограниченные контексты.md`  
   Границы ответственности внутри домена (bounded contexts).
   Основание: `docs/домены/<domain_slug>.md` и покрывающие требования.

---

## 3. Запреты (анти-галлюцинация)
- Запрещено создавать сценарии “по логике” без опоры на факты входа:
  `docs/домены/**` и `docs/requirements/требования/**`.
- Запрещено придумывать use-case сценарии (вход/выход/refresh/…) если они явно не описаны в входных фактах.
- Если данных не хватает — фиксировать это в тексте файла как: `Не определено источниками`
  и добавлять в раздел “Пробелы” внутри файла.

---

## 4. Связь с требованиями (обязательно)
Каждый из трёх файлов домена обязан содержать раздел:

`## Связь с требованиями`

В этом разделе перечисляются ссылки на:
- `docs/requirements/требования/**` (пути или ID)

> В этом разделе ссылаемся **только** на требования, не на сценарии/домены (чтобы сохранить первичную трассировку).

---

## 5. Переходный режим (legacy)
Если сейчас есть общесистемные сценарные артефакты без доменного разбиения:

- `docs/requirements/сценарии/карта процесса.md`
- `docs/requirements/сценарии/каталог мероприятий.md`
- `docs/requirements/сценарии/ограниченные контексты.md`

то они считаются **legacy**, пока не разложены по доменам.

После появления доменов их нужно перенести/разделить в:
- `docs/requirements/сценарии/<domain_slug>/...`

---

## 6. Запрет на запись в `.requirements/**`
Агентам и автоматическим генераторам запрещено:
- создавать файлы,
- изменять файлы,
- перемещать файлы

внутри `.requirements/**`.

Все результаты работы сохраняются только в `docs/**`.
