# Выбор направления исследований и обоснование выбора решений для <PROJECT_NAME>

> **Важно:** это **шаблон** (read-only) в `.requirements/**`.
> Заполненная версия документа ведётся в: `docs/requirements/обоснование выбора.md`.
> Результаты фиксируются только в `docs/**`, шаблоны не изменяем.

---

## 1. Связанные документы
- **Предметная область (документ проекта):** `docs/requirements/предметная область.md`
- **Требования (если уже созданы):**
  - `docs/requirements/требования/**`
- **Архитектура (если уже создана):** `docs/requirements/архитектура/архитектура.md`

---

## 2. Обоснование выбора направления (что и почему выбираем)
На этапе предварительного исследования, опираясь на предметную область, рассматриваются возможные варианты реализации ключевых аспектов системы: **платформа**, **архитектурный стиль**, **интеграции**, **хранилища**, **языки/стек**, **наблюдаемость/DevOps**.  
Цель — зафиксировать **рациональный выбор** (и его границы) на основании сравнения вариантов и ограничений из предметной области.

### 2.1 Критерии выбора (из предметной области)
| Критерий | Приоритет (H/M/L) | Как проверяем/подтверждаем | Примечание |
|---|---|---|---|
| Надёжность/доступность | <H/M/L> | <SLA/SLO, отказовые сценарии> | <...> |
| Производительность | <H/M/L> | <p95/p99, throughput> | <...> |
| Безопасность | <H/M/L> | <модель угроз, требования> | <...> |
| Интеграции/совместимость | <H/M/L> | <контракты, протоколы> | <...> |
| Эксплуатация | <H/M/L> | <мониторинг, алерты, runbooks> | <...> |
| Стоимость владения (TCO) | <H/M/L> | <infra+ops+лицензии> | <...> |
| Экспертиза команды | <H/M/L> | <skill matrix> | <...> |
| Масштабируемость | <H/M/L> | <горизонтальный рост/лимиты> | <...> |
| Вендор-локин | <H/M/L> | <портируемость/standards> | <...> |

### 2.2 Стандарт документации

| Вариант | Применяется | Обоснование |
|---------|-------------|-------------|
| ГОСТ 19 (ЕСПД) | да/нет | <для ПО общего назначения> |
| ГОСТ 34 (АС) | да/нет | <для автоматизированных систем> |
| Внутренний стандарт | да/нет | <описать> |
| Без стандарта | да/нет | <для небольших проектов> |

**Выбранный стандарт:** <ГОСТ 19 / ГОСТ 34 / внутренний / без стандарта>

### 2.3 Формат диаграмм

| Формат | Применяется | Где используется | Обоснование |
|--------|-------------|------------------|-------------|
| PlantUML | да/нет | ArchiMate, Sequence, Activity, Context Map | <...> |
| Mermaid | да/нет | Flowchart, Sequence, ER | <...> |
| Draw.io / Excalidraw | да/нет | Свободные схемы | <...> |

**Выбранный формат:** <plantuml / mermaid / смешанный>

> **Примечание:** выбор формата влияет на шаблоны диаграмм в:
> - `.requirements/архитектура/диаграммы ArchiMate.md`
> - `.requirements/сценарии/диаграммы сценариев.md`
> - `.requirements/сценарии/диаграммы Context Map.md`

---

## 2.4 Процедура заполнения (подтверждение архитектурных решений)

> **ОБЯЗАТЕЛЬНО:** Перед детальным заполнением разделов 3-6 агент ДОЛЖЕН сформулировать кандидатов ключевых решений и получить подтверждение разработчика.

### Почему это важно

Этап [2] определяет фундаментальные архитектурные решения, которые влияют на всю последующую документацию:
- Стандарт документации определяет формат требований [3]
- Методология определяет подход к доменам [4] и сценариям [5]
- Архитектурный паттерн определяет структуру кода [8]
- Технологический стек определяет реализацию [7], [8]

**Ошибка на этом этапе дорого обходится** — придется переделывать несколько последующих артефактов.

### Алгоритм

1. Агент анализирует `.source/` и `docs/requirements/предметная область.md`
2. Формулирует кандидатов ключевых решений (см. формат ниже)
3. Выводит блок "КАНДИДАТЫ АРХИТЕКТУРНЫХ РЕШЕНИЙ — ТРЕБУЕТСЯ ПОДТВЕРЖДЕНИЕ"
4. Ожидает подтверждения или корректировки от разработчика
5. После подтверждения — заполняет детальные разделы 3-6

### Формат блока подтверждения

> **ВНИМАНИЕ:** Формат ниже — это **структура**, а не готовый пример.
> Агент ОБЯЗАН выбрать значения на основе анализа `.source/` и `docs/requirements/предметная область.md`.

```
КАНДИДАТЫ АРХИТЕКТУРНЫХ РЕШЕНИЙ — ТРЕБУЕТСЯ ПОДТВЕРЖДЕНИЕ

На основе анализа предметной области и источников предлагаются решения:

1. СТАНДАРТ ДОКУМЕНТАЦИИ
   Предлагается: <ГОСТ 19 / ГОСТ 34 / внутренний / без стандарта>
   Обоснование: <почему этот стандарт подходит>

2. ФОРМАТ ДИАГРАММ
   Предлагается: <PlantUML / Mermaid / смешанный>
   Обоснование: <почему этот формат>

3. МАСШТАБ СИСТЕМЫ
   Предлагается: <малая / средняя / крупная>
   Обоснование: <команда, домены, нагрузка>

4. МЕТОДОЛОГИЯ МОДЕЛИРОВАНИЯ
   Предлагается: <DDD / Event Storming / CQRS / другая>
   Обоснование: <почему эта методология>

5. АРХИТЕКТУРНЫЙ ПАТТЕРН
   Предлагается: <Layered / Hexagonal / Clean / другой>
   Обоснование: <почему этот паттерн>

6. АРХИТЕКТУРНЫЙ СТИЛЬ
   Предлагается: <Монолит / Модульный монолит / Микросервисы / EDA>
   Обоснование: <почему этот стиль>

7. БАЗОВЫЙ СТЕК (предварительно)
   - Backend: <язык/framework>
   - Frontend: <если есть>
   - Хранилище: <тип БД>
   - Очереди: <если нужны>

Эти решения станут основой для разделов 3-6 и последующих этапов.
Пожалуйста, подтвердите или укажите корректировки.
```

### Правила формирования кандидатов

> Агент извлекает данные **только** из документации проекта и `.source/`.

| Решение | Откуда брать | Как выбирать |
|---------|--------------|--------------|
| Стандарт | `.source/` (ТЗ, договор), отрасль | ГОСТ 34 для АС, ГОСТ 19 для ПО, без стандарта для стартапов |
| Формат диаграмм | Инструменты команды, CI/CD | PlantUML для ArchiMate, Mermaid для простых схем |
| Масштаб | Команда, домены, нагрузка | Таблица 4.1 этого шаблона |
| Методология | Сложность домена, события | DDD если сложный домен, Event Storming если много событий |
| Паттерн | Зависимости, тестируемость | Hexagonal для изоляции, Layered для простоты |
| Стиль | Команда, масштабирование | Монолит для малых, микросервисы для крупных |
| Стек | `.source/`, экспертиза команды | Из предметной области или best practices |

### Важно

- Формат блока — это **структура для заполнения**, не готовый пример
- Агент **запрещено** копировать примеры — только анализировать проект
- Если данных недостаточно — указать "Требуется уточнение" с вариантами и обоснованием

---

## 3. Обоснование выбора платформы
### 3.1 Рассмотренные варианты
| Вариант | Плюсы | Минусы | Риски/ограничения | Итог |
|---|---|---|---|---|
| On-prem (VM/Bare metal) | <...> | <...> | <...> | <выбран/не выбран/отложено> |
| Cloud (IaaS/PaaS) | <...> | <...> | <...> | <...> |
| Hybrid | <...> | <...> | <...> | <...> |
| Edge/Embedded (если применимо) | <...> | <...> | <...> | <...> |

### 3.2 Принятое решение
**Выбрано:** <PLATFORM_DECISION>  
**Основные причины выбора:**
- <причина 1>
- <причина 2>
- <причина 3>

**Границы решения (что входит / что не входит):**
- Входит: <...>
- Не входит / отложено: <...>

---

## 4. Обоснование выбора архитектурного подхода

### 4.1 Масштаб системы

| Масштаб | Характеристики | Типичные решения |
|---------|----------------|------------------|
| **Малая** | 1-3 разработчика, 1 домен, < 10 UC, < 1000 RPS | Монолит, Layered, минимум документации |
| **Средняя** | 3-10 разработчиков, 2-5 доменов, 10-50 UC, 1K-10K RPS | Модульный монолит, DDD light, полная документация |
| **Крупная** | 10+ разработчиков, 5+ доменов, 50+ UC, 10K+ RPS | Микросервисы/EDA, DDD full, строгие контракты |

**Выбранный масштаб:** <малая/средняя/крупная>

**Обоснование:**
- Команда: <размер>
- Домены: <количество>
- Нагрузка: <ожидаемая>
- Срок жизни системы: <1-3 года / 3-5 лет / 5+ лет>

### 4.2 Драйверы архитектурного решения

> Оценить перед выбором стиля. Высокая оценка = сложность, требующая соответствующего решения.

| Драйвер | Оценка (L/M/H) | Описание ситуации | Влияние на выбор |
|---------|----------------|-------------------|------------------|
| **Разделение ответственности** | <L/M/H> | <сколько команд, независимость деплоя> | <монолит/модули/микросервисы> |
| **Масштабируемость** | <L/M/H> | <нагрузка, рост, горячие точки> | <горизонтальное/вертикальное> |
| **Отказоустойчивость** | <L/M/H> | <допустимый downtime, SLA> | <резервирование, graceful degradation> |
| **Доменная сложность** | <L/M/H> | <количество BC, инварианты, правила> | <DDD да/нет, глубина моделирования> |
| **Интенсивность взаимодействия** | <L/M/H> | <sync/async, частота, объем> | <API/Events/Hybrid> |

**Вывод по драйверам:**
- Если большинство L → простая архитектура (монолит, layered)
- Если M/H в "Разделение" и "Масштабируемость" → модульная/микросервисная
- Если H в "Доменная сложность" → DDD обязателен
- Если H в "Взаимодействие" → event-driven или hybrid

### 4.3 Рассмотренные варианты

> **Справочник:** https://github.com/Druk83/arch-patterns — детальное описание архитектурных стилей (при необходимости).

| Вариант | Когда подходит | Сильные стороны | Слабые стороны | Риски | Итог |
|---|---|---|---|---|---|
| Монолит | <...> | <...> | <...> | <...> | <...> |
| Модульная архитектура (слои/модули) | <...> | <...> | <...> | <...> | <...> |
| Микросервисы | <...> | <...> | <...> | <...> | <...> |
| Event-driven (EDA) | <...> | <...> | <...> | <...> | <...> |
| Serverless/Functions | <...> | <...> | <...> | <...> | <...> |

### 4.4 Принятое решение
**Выбрано:** <ARCH_DECISION>
**Почему:**
- <...>
- <...>

**Принципы и ограничения:**
- <например: единые контракты, изоляция модулей, запрет циклических зависимостей, границы контекстов и т.п.>

### 4.5 Методология моделирования и паттерны

#### 4.5.1 Методологии моделирования (самый высокий уровень)
**Как думаем о доменах, событиях и состояниях:**

| Методология | Применяется | Где используется | Обоснование |
|-------------|-------------|------------------|-------------|
| DDD (Domain-Driven Design) | да/нет | домены, агрегаты, bounded contexts | <почему выбрана/отклонена> |
| Event Storming | да/нет | выявление сценариев и событий | <...> |
| CQRS (Command Query Responsibility Segregation) | да/нет | разделение read/write моделей | <...> |
| Event Sourcing | да/нет | хранение истории событий вместо состояния | <...> |

#### 4.5.2 Архитектурные паттерны (уровень слоёв приложения)
**Как организуем приложение внутри, границы между слоями:**

| Паттерн | Применяется | Где используется | Обоснование |
|---------|-------------|------------------|-------------|
| Layered (N-tier) | да/нет | структура модулей по горизонтальным слоям | <...> |
| Hexagonal (Ports & Adapters) | да/нет | изоляция доменной логики от внешних систем | <...> |
| Clean Architecture | да/нет | зависимости направлены внутрь к домену | <...> |
| MVC/MVP/MVVM | да/нет | взаимодействие UI с бизнес-логикой | <...> |

#### 4.5.3 Паттерны проектирования (самый конкретный уровень кода)
**Как решаем задачи в конкретном коде:**

| Паттерн | Где применяется | Назначение |
|---------|-----------------|------------|
| Repository | доступ к данным | абстракция хранилища, независимость от БД |
| Factory | создание объектов | инкапсуляция логики создания |
| Strategy | бизнес-логика | сменяемые алгоритмы в runtime |
| Observer/Pub-Sub | события | слабая связанность компонентов |
| Dependency Injection | конструкторы, конфиг | управление зависимостями |
| <другие> | <...> | <...> |

---

## 5. Архитектурная схема и ключевые компоненты (выбранный состав)
> Это “каркас”: компоненты + технологии + статус. Детализация будет в архитектурном документе.

| Компонент | Технология/протокол (предварительно) | Статус (Обяз/Опц/Отложено) | Обоснование |
|---|---|---|---|
| API / Gateway | <...> | <...> | <...> |
| Auth / IAM | <...> | <...> | <...> |
| Основное хранилище | <...> | <...> | <...> |
| Очереди/события | <...> | <...> | <...> |
| Поиск (если нужен) | <...> | <...> | <...> |
| Файлы/артефакты | <...> | <...> | <...> |
| Наблюдаемость | <...> | <...> | <...> |
| CI/CD | <...> | <...> | <...> |
| UI/Клиенты | <...> | <...> | <...> |

---

## 6. Технологический стек и прикладной слой
### 6.1 Языки программирования и назначение
| Уровень системы | Основные технологии | Назначение/роль | Примечание |
|---|---|---|---|
| Backend / API | <...> | <...> | <...> |
| Интеграции | <...> | <...> | <...> |
| Data processing (если есть) | <...> | <...> | <...> |
| Frontend / UI | <...> | <...> | <...> |
| DevOps / IaC | <...> | <...> | <...> |

### 6.2 Хранилища и данные
| Назначение | Система | Обоснование | Альтернативы |
|---|---|---|---|
| Транзакционные данные | <...> | <...> | <...> |
| Кэш / очереди | <...> | <...> | <...> |
| Поиск | <...> | <...> | <...> |
| Объектное/файловое хранилище | <...> | <...> | <...> |

### 6.3 Интеграция и обмен данными
| Тип интеграции | Вариант | Где применяется | Почему выбран |
|---|---|---|---|
| Синхронная | REST/gRPC | <...> | <...> |
| Асинхронная | broker/events | <...> | <...> |
| Входящие вызовы | webhooks | <...> | <...> |
| Пакетная | ETL/Batch | <...> | <...> |

---

## 7. Функциональные возможности (в привязке к предметной области)
> Не переписываем предметную область, только фиксируем “что обязаны покрыть” как следствие выбора.
**Структура (при необходимости):**
| Функция/возможность | Источник (UC/требование) | Компонент системы | Статус покрытия |
|---|---|---|---|
| <функция 1> | <...> | <...> | обязательна/опциональна |
| <функция 2> | <...> | <...> | <...> |

**Или простой список:**

- <Функция/возможность 1 из предметной области>
- <Функция/возможность 2>
- <...>

---

## 8. Нефункциональные показатели (целевые ориентиры)
> **Связь с 2.1:** детализируем критерии из предметной области (раздел 2.1) в конкретные, измеримые показатели для выбранной архитектуры.

| Категория | Целевое значение | Как обеспечиваем (направление) |
|---|---|---|
| Надёжность | <...> | <...> |
| Производительность | <...> | <...> |
| Безопасность | <...> | <...> |
| Масштабируемость | <...> | <...> |
| Поддерживаемость | <...> | <...> |
| Наблюдаемость | <...> | <...> |

---

## 9. Критические требования эксплуатации
1. <backup/restore требования>
2. <RPO/RTO>
3. <security access (MFA/RBAC/audit)>
4. <retention/logging/архивирование>
5. <совместимость/миграции/обновления>

---

## 10. Риски и открытые вопросы
### 10.1 Риски
| Риск | Проявление | Вероятность (L/M/H) | Влияние (L/M/H) | Компенсация |
|---|---|---|---|---|
| <...> | <...> | <...> | <...> | <...> |

### 10.2 Открытые вопросы
| Вопрос | Почему важно | Как закрываем (PoC/интервью/расчёт) | Дедлайн | Владелец |
|---|---|---|---|---|
| <...> | <...> | <...> | <YYYY-MM-DD> | <...> |

---

## 11. Вывод (итог выбора)
Принято решение использовать: **<platform> + <architecture> + <integration> + <data layer> + <languages/stack>**.  

**Выбор обусловлен:**
- Оценкой драйверов из раздела 4.2 (особенно: <драйвер 1: L/M/H>, <драйвер 2>)
- Требованиями предметной области (раздел 2.1): <3–6 буллетов причин>
- Масштабом системы (раздел 4.1): <малая/средняя/крупная>

**Открытые вопросы/PoC:**
- <1–3 пункта с ссылкой на Приложение B, если есть>

**Следующий шаг:** подготовка документов по архитектуре и стеку на основании выбранного направления. При необходимости — реализация PoC по критическим пунктам (Приложение B).

---

## Приложение A. Протокол консультаций/источников (опционально)
| Дата | Источник/эксперт | Тема | Ключевой вывод |
|---|---|---|---|
| <...> | <...> | <...> | <...> |

## Приложение B. План PoC/проверок (опционально)
| Проверка | Цель | Метод | Критерий успеха | Срок |
|---|---|---|---|---|
| <...> | <...> | <...> | <...> | <...> |

---

## Приложение C. Чеклист готовности этапа [2]

> **Обязательно:** агент проверяет этот чеклист перед переходом к этапу [3].

### C.1 Минимальные критерии (блокируют переход)

- [ ] **Стандарт документации:** выбран (ГОСТ 19 / ГОСТ 34 / внутренний / без стандарта) (раздел 2.2)
- [ ] **Формат диаграмм:** выбран (PlantUML / Mermaid / смешанный) (раздел 2.3)
- [ ] **Методология моделирования:** выбрана >= 1 (DDD / Event Storming / CQRS / другая) (раздел 4.5.1)
- [ ] **Архитектурный паттерн:** выбран >= 1 (Layered / Hexagonal / Clean / другой) (раздел 4.5.2)
- [ ] **Масштаб системы:** определён (малая / средняя / крупная) (раздел 4.1)
- [ ] **Технологический стек:** определён базовый набор (раздел 6)

### C.2 Рекомендуемые критерии (желательны)

- [ ] **Платформа:** выбрана с обоснованием (раздел 3)
- [ ] **Архитектурный стиль:** выбран с обоснованием (раздел 4.3-4.4)
- [ ] **Критерии выбора:** заполнены с приоритетами H/M/L (раздел 2.1)
- [ ] **Драйверы архитектуры:** оценены (раздел 4.2)
- [ ] **Риски:** >= 1 риск с компенсацией (раздел 10.1)
- [ ] **Открытые вопросы:** зафиксированы с дедлайнами (раздел 10.2)

### C.3 Gap Tracking и Placeholder'ы

- [ ] **gap-tracking.md обновлён:** все пробелы зафиксированы
- [ ] **Задачи созданы:** для каждого HIGH/MEDIUM пробела создана задача в `.tasks/`
- [ ] **Placeholder'ы с маркерами:** все `<placeholder>` помечены `<!-- @update-after:[N] -->`
- [ ] **Нет устаревших маркеров:** проверить `@update-after:[2]` в ранее созданных docs — обновить или удалить

### C.4 Подпись готовности

| Критерий | Факт | Статус |
|----------|------|--------|
| Стандарт документации выбран | <стандарт> | OK / NOT OK |
| Формат диаграмм выбран | <формат> | OK / NOT OK |
| Методология >= 1 | <методология> | OK / NOT OK |
| Арх. паттерн >= 1 | <паттерн> | OK / NOT OK |
| Масштаб определён | <масштаб> | OK / NOT OK |
| Стек определён | да / нет | OK / NOT OK |

**Дата проверки:** <YYYY-MM-DD>
**Проверил:** <agent/person>
