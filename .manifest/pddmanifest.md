# PDD Manifest (H2)

Политики и стандарты Puzzle Driven Development: формат `@todo`, привязка к задачам, жизненный цикл и сканирование.

---

## pdd.H3.1 Привязывай @todo к задачам
Каждый @todo должен ссылаться на существующую задачу в `.tasks/`.
**Почему важно:**
Без привязки к задаче теряется контекст, приоритет и критерий готовности. @todo становится бесполезной заметкой.

---

## pdd.H4.1 Формат @todo
**Заголовок (1 строка, обязателен):**
```
@todo #<TASK-ID>:<EST> <SUMMARY>
```
**Пример:**
```
@todo #A6-01:2h Добавить RBAC middleware
```
**Полный пример с полями:**
```text
/// @todo #A6-01:2h Добавить RBAC middleware
/// refs: .tasks/A6-01.md
/// scope: services/auth/middleware
/// type: feature
/// prio: P2
/// accept: роли берутся из JWT claims; тесты на 3 роли
```

---

## pdd.H4.2 Обязательные и рекомендуемые поля
**Обязательные ключи:**
- `refs: .tasks/<TASK-ID>.md` - ссылка на задачу (всегда обязателен)
**Рекомендуемые ключи:**
- `scope: <path/module>` - где находится работа
- `accept: <criteria>` - краткий критерий готовности
- `prio: P1|P2|P3` - приоритет
- `type: feature|bug|debt|refactor|docs|test` - тип
- `owner: <team/person>` - владелец (если принят)
- `blocked-by: <TASK-ID>` - блокер
- `defer: <milestone/version/date>` - осознанный перенос

---

## pdd.H4.3 Оценка времени (EST)
**Допустимые значения:**
`15m, 30m, 1h, 2h, 4h, 8h, 1d` (где `1d = 8h`)
**Правило:**
Оценка округляется вверх до ближайшего значения.

---

## pdd.H4.4 Порядок создания @todo
**Последовательность:**
1. Сначала создай `.tasks/<TASK-ID>.md` (если задачи еще нет)
2. Затем добавь `@todo` в код со ссылкой `refs: .tasks/<TASK-ID>.md`
3. @todo должен быть кратким (заголовок + EST + `accept` при необходимости)
**Быстрый чеклист:**
- [ ] Файл задачи существует
- [ ] @todo содержит `refs: .tasks/<TASK-ID>.md`
- [ ] @todo краткий (заголовок + EST + accept при необходимости)
**Запрещено:**
- Создавать @todo без существующей задачи
- Дублировать содержательное наполнение задачи в @todo (полная спецификация в `.tasks/`)
- Оставлять @todo без `refs:`

---

## pdd.H3.2 Используй @todo для незавершенной работы
@todo предназначен для конкретных единиц работы, не для заметок или размышлений.
**Почему важно:**
Смешивание @todo с заметками превращает код в помойку комментариев без четких действий.

---

## pdd.H4.5 Когда использовать и не использовать @todo
**Используй @todo если:**
- Есть незавершенная часть фичи с понятным next step
- Есть временная заглушка с четким планом
- Есть техдолг, который важно не забыть
**НЕ используй @todo если:**
- Это "мысли вслух", личные заметки
- Это полноценная спецификация (ей место в `docs/requirements/`)
- Задача без ясного next step (лучше issue - см. [issuesmanifest.md](issuesmanifest.md))

---

## pdd.H3.3 Удаляй @todo после выполнения
Закрытый @todo должен быть удален из кода, информация о выполнении - в задаче.
**Почему важно:**
Накопление мертвых @todo загромождает код, снижает доверие к актуальным @todo, затрудняет навигацию.

---

## pdd.H4.6 Процесс закрытия @todo
**Когда @todo выполнен:**
1. Удали @todo из кода
2. Зафиксируй ссылку на PR/commit в `.tasks/<TASK-ID>.md`
3. Если работа частичная - обнови `accept:` и `EST` (уменьши), добавь `defer:` при переносе
**Критерий готовности @todo:**
- Реализован код + тесты (если применимо)
- Задача `.tasks/<TASK-ID>.md` обновлена (PR/commit ссылка)
- @todo удален или (редко) заменен на документированный design note
**Опционально разрешено:**
`DONE`-метки в коде только если это важно как design note. `DONE` не используется вместо `@todo` и не является признаком закрытия задачи.

---

## pdd.H4.7 Сканирование и реестр @todo
**Канонический инструмент:**
`.tools/pdd/pdd-scan` (запуск/опции/форматы - см. [.tools/pdd/README.md](.tools/pdd/README.md))
**Рекомендуемый порядок:**
1. Обновить реестр: запусти сканер PDD (см. `.tools/pdd/README.md`)
   - Результат: обновленный реестр в `.tasks/pdd/`
2. Быстрая локальная проверка (не каноническая): `grep -R "@todo" .`
3. Автоматизация: CI/агент читает реестр из `.tasks/pdd/` и валидирует политики (наличие `refs`)
**В CI:**
Добавь job, который запускает сканер и выдает warning/fail при нарушениях policy (@todo без `refs`). История реестра хранится через git.

---

## pdd.H4.8 Правила для агента
**Агент может:**
- Добавлять @todo при генерации заглушек только с валидным TASK-ID
- При отсутствии задачи - создать `.tasks/<TASK-ID>.md` по шаблону
- Предлагать команды для сканирования и список актуальных @todo
**Агент не может:**
- Делать commit/push
- Создавать новые правила без явного запроса
- Оставлять @todo без `accept:` если это функциональная доработка (feature/bug)
