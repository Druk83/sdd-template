# PDD Manifest (Puzzle Driven Development)

Документ задаёт правила использования PDD-пазлов в кодовой базе: формат `@todo`, привязку к `.tasks/`,
проверки, review и правила для агентов/автоматизации.

---

## 1) Привязывай @todo к задаче в .tasks/

- PDD-пазл (`@todo`) — маленькая единица работы в коде, **обязательно** привязанная к задаче в `.tasks/`.
- Пазл должен быть исполнимым: понятный контекст, критерий готовности, оценка.
- PDD-пазл не заменяет документацию: реестр PDD (список `@todo`) хранится в `.tasks/pdd/*`;
  фактические архитектура и требования — в `docs/requirements/*` (шаблоны/методики — в `.requirements/*`).

---

## 2) Используй формат @todo #TASK-ID:EST SUMMARY

### 2.1 Заголовок (1 строка, обязателен)
Формат:
`@todo #<TASK-ID>:<EST> <SUMMARY>`

Пример:
`@todo #A6-01:2h Добавить RBAC middleware`

### 2.2 Поля (строки `key: value`)
Поля задаются строками `key: value` сразу после заголовка.

**Обязательные ключи:**
- `refs: .tasks/<TASK-ID>.md` — ссылка на задачу (обязателен всегда)

**Рекомендуемые ключи:**
- `scope: <path/module>` — где находится работа
- `accept: <criteria>` — краткий критерий готовности
- `prio: P1|P2|P3` — приоритет
- `type: feature|bug|debt|refactor|docs|test` — тип
- `owner: <team/person>` — владелец (если принят)
- `blocked-by: <TASK-ID>` — блокер
- `defer: <milestone/version/date>` — осознанный перенос

Пример:
```text
/// @todo #A6-01:2h Добавить RBAC middleware
/// refs: .tasks/A6-01.md
/// scope: services/auth/middleware
/// type: feature
/// prio: P2
/// accept: роли берутся из JWT claims; тесты на 3 роли
```

---

## 3) Сначала создай задачу, потом @todo

* `@todo` **всегда** должен ссылаться на существующую задачу: `.tasks/<TASK-ID>.md`.
* Если задачи ещё нет — сначала создайте `.tasks/<TASK-ID>.md`, затем добавляйте `@todo`.
* `@todo` **не должен дублировать** содержательное наполнение задачи; полная спецификация и чек-листы — в `.tasks/<TASK-ID>.md`.
* Подробные правила и шаблоны задач — в `.manifest/taskmanifest.md`.

Быстрый чек-лист:

* файл задачи существует;
* `@todo` содержит `refs: .tasks/<TASK-ID>.md`;
* `@todo` краткий (заголовок + EST + `accept` при необходимости).

---

## 4) Указывай оценку времени (EST)

Допустимые значения:
`15m, 30m, 1h, 2h, 4h, 8h, 1d` (где `1d = 8h`)

Правило:

* оценка округляется вверх до ближайшего значения.

---

## 5) Используй @todo для незавершённой работы, не для заметок

Использовать `@todo`, если:

* есть незавершённая часть фичи с понятным next step
* есть временная заглушка с чётким планом
* есть техдолг, который важно не забыть

Не использовать `@todo`, если:

* это “мысли вслух”, личные заметки
* это полноценная спецификация (ей место в `docs/requirements/**`)
* задача без ясного next step (лучше issue — см. `.manifest/issuesmanifest.md`)

---

## 6) Удаляй @todo после выполнения

* Если `@todo` закрыт — **удалить из кода**.
* Ссылка на PR/commit фиксируется в `.tasks/<TASK-ID>.md`.
* Если работа частичная — обновить `accept:` и `EST` (уменьшить), добавить `defer:` при переносе.
* Запрещено оставлять `@todo` без `refs:`.

Опционально разрешено:

* `DONE`-метки в коде **только** если это важно как design note.
  `DONE` не используется вместо `@todo` и не является признаком закрытия задачи.

---

## 7) Сканируй и обновляй реестр @todo

Цель: получать **актуальный реестр** PDD-пазлов (`@todo`) и применять политики (refs/тип/возраст).

Канонический инструмент:

* `.tools/pdd/pdd-scan` (запуск/опции/форматы — см. `.tools/pdd/README.md`)

Рекомендуемый порядок:

1. Обновить реестр (канонический способ): запустить сканер PDD (см. `.tools/pdd/README.md`).

   * Результат: обновлённый реестр в `.tasks/pdd/` (конкретные пути и форматы — по инструменту).
2. Быстрая локальная проверка (не каноническая, но быстрая): `grep -R "@todo" .`
3. Автоматизация: CI/агент читает реестр из `.tasks/pdd/` и валидирует политики (например, наличие `refs` и т.п.).

CI:

* Добавьте job, который запускает сканер и выдаёт warning/fail при нарушениях policy (например, `@todo` без `refs`).
* История реестра хранится через git.

---

## 8) Правила для агента

Агент может:

* добавлять `@todo` при генерации заглушек **только** с валидным `TASK-ID`
* при отсутствии задачи — создать `.tasks/<TASK-ID>.md` по шаблону
* предлагать команды для сканирования и список актуальных `@todo`

Агент не может:

* делать commit/push
* создавать новые правила без явного запроса
* оставлять `@todo` без `accept:` если это функциональная доработка (feature/bug)

---

## 9) Проверь критерий готовности @todo

`@todo` выполнен, когда:

* реализован код + тесты (если применимо)
* задача `.tasks/<TASK-ID>.md` обновлена (PR/commit ссылка)
* `@todo` удалён или (редко) заменён на документированный design note
