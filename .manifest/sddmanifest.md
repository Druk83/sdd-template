# SDD Manifest (Specification-Driven Development)

Документ задаёт правила работы агента с разработчиком при создании технической документации
по методике SDD. Определяет последовательность шагов, точки остановки и формат взаимодействия.

---

## 1) Прими системные правила перед началом работы

Агент ОБЯЗАН прочитать и принять правила из:
- `.claude/CLAUDE.md` (для Claude) или `.github/copilot-instructions.md` (для Copilot)
- `.manifest/sddmanifest.md` (этот файл)

Разработчик инициирует сессию командой:
```
Прими системные правила из .claude/CLAUDE.md
Мы выполняем задачу по разработке технической документации.
```

Агент подтверждает:
```
Системные правила приняты. Готов к работе по SDD.
```

---

## 2) Изучи исходные данные в .source/

Папка `.source/` содержит неструктурированные входные данные:
- Идеи и концепции
- Черновики требований
- Переписка с заказчиком
- Ссылки на аналоги
- Любые материалы, описывающие задачу

Агент ОБЯЗАН:
1. Прочитать все файлы в `.source/`
2. Составить краткое резюме понятого контекста
3. Выявить пробелы и неясности

Агент НЕ ДОЛЖЕН:
- Начинать документирование без анализа `.source/`
- Предполагать данные, которых нет в источниках

---

## 3) Уточняющие вопросы (только при необходимости)

Агент **сам строит артефакты** на основе `.source/`, логики и best practices.
Вопросы разработчику — только когда агент не может принять решение самостоятельно.

### 3.1 Когда агент спрашивает

Агент задаёт вопросы ТОЛЬКО в двух случаях:

| Тип вопроса | Когда задавать |
|-------------|----------------|
| **Выбор из вариантов** | Есть несколько равноценных решений, агент не может выбрать лучшее |
| **Разрешение коллизии** | Противоречие, разночтение или неточность в источниках |

### 3.2 Базовый контекст (особый случай)

Иногда `.source/` содержит неполную информацию о **фундаментальных** вещах:
- Название системы / продукта
- Определение и назначение системы
- Ключевая проблема, которую решает система
- Целевая аудитория

Это **не выбор из вариантов** и **не коллизия** — это базовый контекст, который агент должен сформулировать сам, но **требуется подтверждение** разработчика.

**Алгоритм работы:**

1. Агент анализирует `.source/` и формулирует базовый контекст
2. Помечает сформулированное маркером `<!-- @base-context -->`
3. Выводит блок "БАЗОВЫЙ КОНТЕКСТ — ТРЕБУЕТСЯ ПОДТВЕРЖДЕНИЕ"
4. Ожидает реакции разработчика
5. Если разработчик вносит правки — агент обновляет артефакт
6. Если разработчик не подтверждает — создаётся GAP

**Формат вывода:**

```
БАЗОВЫЙ КОНТЕКСТ — ТРЕБУЕТСЯ ПОДТВЕРЖДЕНИЕ

На основе анализа .source/ агент сформулировал:

Название системы: <название>
Определение: <что это и зачем>
Ключевая проблема: <какую проблему решает>
Целевая аудитория: <для кого>

Это станет основой всей документации.
Пожалуйста, подтвердите или скорректируйте.
```

**Маркер в артефакте:**

```markdown
<!-- @base-context: название системы, определение — сформулировано агентом, требует подтверждения -->
## 1. Название и назначение

**Название системы:** CodeReview Assistant
**Определение:** Система автоматизации code review для GitHub-репозиториев
```

**После подтверждения:**
- Агент удаляет маркер `<!-- @base-context -->`
- Продолжает работу

**Если нет подтверждения:**
- Агент создаёт GAP с критичностью HIGH
- GAP блокирует все последующие этапы

### 3.3 Формат вопросов

```
ТРЕБУЕТСЯ РЕШЕНИЕ РАЗРАБОТЧИКА

Выбор из вариантов:
1. <Вариант A>: <плюсы/минусы>
2. <Вариант B>: <плюсы/минусы>
Рекомендация агента: <вариант> потому что <причина>

Коллизии:
- <Описание противоречия>
  Источник 1: ...
  Источник 2: ...
  Вопрос: какой вариант верный?
```

### 3.4 Агент НЕ спрашивает

- То, что выводится логически из предыдущих этапов
- То, что определяется best practices отрасли
- Очевидные вещи из контекста
- Детали, которые определятся на следующих этапах
- Вопросы ради вопросов

### 3.5 Принцип работы

```
Агент анализирует .source/
        ↓
Это базовый контекст (название, определение, цель)?
   ДА → формулирует сам, помечает @base-context, просит подтвердить
   НЕТ ↓
        ↓
Строит артефакт самостоятельно (логика + best practices)
        ↓
Встречает неопределённость?
   НЕТ → продолжает
   ДА → можно решить самому?
           ДА → решает и продолжает
           НЕТ → спрашивает разработчика (выбор/коллизия)
```

---

## 4) Следуй треку разработки пошагово

После получения ответов агент читает `.requirements/трек разработки.md` и выполняет этапы **строго по одному**.

### 4.1 Последовательность этапов

```
[1] Предметная область → [2] Обоснование выбора → [3] Требования →
[4] Домены → [5] Сценарии → [5.5] Диаграммы сценариев →
[6] Структура данных → [7] Архитектура → [7.1] Диаграммы ArchiMate →
[8] Структура ПО → [9] Тестирование
```

### 4.2 Правило одного этапа

Агент выполняет **ТОЛЬКО ОДИН** этап за запрос:
- Читает шаблон из `.requirements/`
- Создаёт артефакт в `docs/requirements/`
- Выводит отчёт о завершении
- **ОСТАНАВЛИВАЕТСЯ** и ждёт команды

### 4.3 Правило полного завершения

Агент НЕ ПЕРЕХОДИТ к следующему этапу, пока текущий не выполнен **полностью**.

**"Не определено источниками" недопустимо в финальном артефакте.**

После создания артефакта агент:
1. Проверяет на "Не определено"
2. Пытается достроить самостоятельно (логика + best practices)
3. Если не может решить сам — спрашивает разработчика (выбор/коллизия)
4. Достраивает артефакт после ответов
5. Повторяет проверку пока артефакт не будет полным

### 4.4 Запрещённые действия

Агент НЕ ДОЛЖЕН:
- Выполнять несколько этапов в одном ответе
- Автоматически переходить к следующему этапу
- Пропускать этапы без явного указания разработчика
- Оставлять "Не определено" в финальном артефакте
- Переходить к следующему этапу с неполным текущим

---

## 5) Останавливайся после каждого этапа

### 5.1 Формат отчёта о завершении

После каждого этапа агент выводит:
```
---
ЭТАП [N] ЗАВЕРШЕН

Созданные артефакты:
- docs/requirements/<файл1>.md
- docs/requirements/<файл2>.md

Чеклист готовности:
- [x] Глоссарий заполнен (12 терминов)
- [x] Акторы определены (3 роли)
- [ ] Use Cases неполные -> GAP-001

Найденные пробелы: 1 (см. gap-tracking.md)

ОЖИДАЮ КОМАНДЫ для продолжения
---
```

### 5.2 Команды разработчика

| Команда | Действие агента |
|---------|-----------------|
| `Продолжай этап [N]` | Начать следующий этап |
| `Исправь: <описание>` | Внести правки в текущий артефакт |
| `Покажи статус` | Вывести текущее состояние всех этапов |
| `Добавь GAP: <описание>` | Добавить запись в gap-tracking.md |
| `Вернись к этапу [N]` | Переделать указанный этап |

---

## 6) Веди gap-tracking

Агент ОБЯЗАН вести файл `docs/requirements/gap-tracking.md`:

### 6.1 Когда добавлять GAP

- Данные отсутствуют в источниках
- Требуется решение разработчика/заказчика
- Обнаружено противоречие в требованиях
- Зависимость от внешнего фактора

### 6.2 Формат GAP

```markdown
| GAP-ID | Этап | Описание | Критичность | Блокирует | Статус |
|--------|------|----------|-------------|-----------|--------|
| GAP-001 | [1] | Не определены роли пользователей | HIGH | [3], [5] | OPEN |
```

### 6.3 Критичность

- `HIGH` — блокирует несколько этапов, требует немедленного решения
- `MEDIUM` — блокирует 1 этап, решить до перехода
- `LOW` — не блокирует, можно отложить

### 6.4 Задачи .tasks/ при SDD не создаются

При разработке документации (SDD):
- Пробелы фиксируются ТОЛЬКО в `gap-tracking.md`
- Задачи в `.tasks/` НЕ создаются

Задачи `.tasks/` создаются позже — при разработке кода (см. `.manifest/taskmanifest.md`).

---

## 7) Работай с диаграммами правильно

### 7.1 Правила создания диаграмм

1. Код диаграммы → отдельный файл `*.plantuml` или `*.mmd`
2. Рендеринг → PNG/SVG в той же папке
3. В markdown → ссылка на изображение + комментарий с путём к исходнику

### 7.2 Структура файлов

```
docs/requirements/
  diagrams/
    domain-overview.plantuml
    domain-overview.png
  сценарии/<domain>/diagrams/
    UC-01-sequence.plantuml
    UC-01-sequence.png
```

### 7.3 Вставка в документ

```markdown
<!-- Исходный код: diagrams/domain-overview.plantuml -->
![Обзор домена](diagrams/domain-overview.png)
```

---

## 8) Правила для агента (сводка)

### 8.1 Агент ОБЯЗАН

1. Принять системные правила перед началом
2. Изучить `.source/` и самостоятельно строить артефакты
3. **Сформулировать базовый контекст** (название, определение, цель) и запросить подтверждение
4. Следовать `.requirements/трек разработки.md`
5. Выполнять **один этап за раз**
6. **Полностью завершать этап** перед переходом к следующему
7. Спрашивать разработчика только при выборе из вариантов или коллизии
8. Останавливаться после каждого этапа
9. Вести gap-tracking.md
10. Выносить диаграммы в отдельные файлы
11. Проверять чеклист готовности этапа

### 8.2 Агент НЕ ДОЛЖЕН

1. Начинать документирование без анализа `.source/`
2. Выполнять несколько этапов за раз
3. Переходить к следующему этапу без команды
4. Оставлять "Не определено" в финальном артефакте
5. Спрашивать очевидные вещи или то, что выводится логически
6. Редактировать файлы в `.requirements/` (read-only)
7. Делать git commit/push
8. Оставлять inline-диаграммы в markdown
9. Создавать задачи в `.tasks/` (при SDD используется только gap-tracking.md)

---

## 9) Типичная сессия (пример)

```
РАЗРАБОТЧИК: Прими правила из .claude/CLAUDE.md
             Мы делаем техническую документацию.
             Исходные данные в .source/

АГЕНТ:       Системные правила приняты.
             [Читает .source/]

             БАЗОВЫЙ КОНТЕКСТ — ТРЕБУЕТСЯ ПОДТВЕРЖДЕНИЕ

             На основе анализа .source/ агент сформулировал:

             Название системы: CodeReview Assistant
             Определение: Система автоматизации code review для GitHub-репозиториев
             Ключевая проблема: Ручной code review занимает много времени и пропускает ошибки
             Целевая аудитория: Разработчики и тимлиды, использующие GitHub

             Это станет основой всей документации.
             Пожалуйста, подтвердите или скорректируйте.

РАЗРАБОТЧИК: Название поменяй на "CodeGuard", остальное верно

АГЕНТ:       Принято. Базовый контекст обновлён.
             Начинаю этап [1].

             [Строит docs/requirements/предметная область.md самостоятельно]

             ТРЕБУЕТСЯ РЕШЕНИЕ РАЗРАБОТЧИКА

             Выбор из вариантов:
             В .source/ упоминаются и GitHub, и GitLab.
             1. Только GitHub: проще интеграция
             2. GitHub + GitLab: шире охват
             Рекомендация: вариант 1, т.к. в описании акцент на GitHub

             [ожидаю решения]

РАЗРАБОТЧИК: Вариант 1, только GitHub

АГЕНТ:       [Достраивает артефакт]

             ---
             ЭТАП [1] ЗАВЕРШЕН
             Артефакты: docs/requirements/предметная область.md
             Чеклист: [x] глоссарий [x] акторы [x] UC [x] границы
             Пробелы: 0
             ОЖИДАЮ КОМАНДЫ
             ---

РАЗРАБОТЧИК: Добавь в глоссарий термин "Quality Gate"

АГЕНТ:       [Обновляет глоссарий]
             Готово. Ожидаю команды.

РАЗРАБОТЧИК: Продолжай этап [2]

АГЕНТ:       [Читает шаблон, строит артефакт самостоятельно]
             ...
```

---

## 10) Чеклист готовности сессии

Перед началом работы проверить:

- [ ] `.source/` содержит исходные материалы
- [ ] Агент принял системные правила
- [ ] Агент изучил `.source/`
- [ ] Агент готов начать этап [1]

После каждого этапа проверить:

- [ ] Артефакт создан в `docs/requirements/`
- [ ] Нет "Не определено" в артефакте
- [ ] Чеклист готовности пройден
- [ ] Коллизии разрешены (если были)
- [ ] Агент остановился и ждёт команды
