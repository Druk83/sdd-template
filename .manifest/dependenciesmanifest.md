# Dependencies Manifest (H2)

Политики и стандарты управления зависимостями проекта.

---

## dependencies.H3.1 Не устанавливай вслепую
Перед добавлением любой зависимости обязательно проверь её безопасность, актуальность и совместимость.
**Почему важно:**
Непроверенная зависимость может содержать уязвимости, быть несовместимой с проектом или брошенной разработчиками.

---

## dependencies.H4.1 Выполни проверки перед установкой
**Что проверить:**
1. Уязвимости (CVE) - используй команды из dependencies.H4.2
2. Актуальность - последний релиз < 2 лет, не abandoned
3. Совместимость - версия рантайма проекта поддерживается
4. Лицензия - совместима с проектом
5. Стабильность - stable/LTS, не alpha/beta/rc
**Если проверка не пройдена:**
Сообщи пользователю, не устанавливай без подтверждения.

---

## dependencies.H4.2 Команды аудита уязвимостей
| Язык | Аудит уязвимостей | Проверка outdated |
|------|-------------------|-------------------|
| JavaScript | `npm audit` / `yarn audit` | `npm outdated` |
| Python | `pip-audit` / `safety check` | `pip list --outdated` |
| Go | `govulncheck ./...` | `go list -u -m all` |
| Rust | `cargo audit` | `cargo outdated` |
| Ruby | `bundle audit` | `bundle outdated` |
| PHP | `composer audit` | `composer outdated` |
**После установки:**
Всегда выполни аудит и сообщи результат пользователю.

---

## dependencies.H3.2 Реагируй на критические уязвимости
Не игнорируй уязвимости CRITICAL и HIGH. Они представляют реальную угрозу безопасности.
**Почему важно:**
Уязвимости высокого уровня могут привести к компрометации системы, утечке данных или отказу в обслуживании.

---

## dependencies.H4.3 Действия по уровню CVE
| Уровень | CVSS | Действие |
|---------|------|----------|
| CRITICAL | 9.0+ | Предупредить немедленно, предложить обновление или альтернативу |
| HIGH | 7.0-8.9 | Предупредить, предложить обновление |
| MEDIUM | 4.0-6.9 | Сообщить, предложить запланировать |
| LOW | < 4.0 | Сообщить, оставить на усмотрение |
**Если патч недоступен:**
1. Сообщи об этом явно
2. Предложи альтернативные пакеты
3. Не продолжай установку без подтверждения пользователя

---

## dependencies.H3.3 Фиксируй версии зависимостей
Используй lock-файлы для гарантии воспроизводимости сборок.
**Почему важно:**
Без lock-файлов разные установки могут получить разные версии зависимостей, что приведет к несовместимости и непредсказуемым ошибкам.

---

## dependencies.H4.4 Lock-файлы по языкам
| Язык | Манифест | Lock-файл |
|------|----------|-----------|
| JavaScript/TS | package.json | package-lock.json / yarn.lock / pnpm-lock.yaml |
| Python | pyproject.toml / requirements.txt | poetry.lock / Pipfile.lock |
| Go | go.mod | go.sum |
| Rust | Cargo.toml | Cargo.lock |
| Ruby | Gemfile | Gemfile.lock |
| PHP | composer.json | composer.lock |
**После любой операции с зависимостями:**
1. Обнови lock-файл
2. Убедись, что lock-файл будет в git
3. Сообщи пользователю об изменениях

**Запрещено:**
- Использовать `*` или `latest` в версиях
- Устанавливать без lock-файла
- Прямые ссылки на git (кроме форков с обоснованием)

---

## dependencies.H3.4 Не применяй force при конфликтах
При конфликте версий требуется явное решение пользователя, а не обход проверок.
**Почему важно:**
Force-флаги маскируют реальные проблемы совместимости, которые проявятся в runtime.

---

## dependencies.H4.5 Разрешение конфликтов версий
**При конфликте peer dependencies:**
1. Сообщи о конфликте - опиши, какие пакеты конфликтуют
2. Предложи варианты - обновить, даунгрейдить, найти альтернативу
3. Дождись решения - не продолжай без подтверждения
**Запрещено без явного запроса пользователя:**
- `--force`
- `--legacy-peer-deps`
- `npm install --force`
- `pip install --ignore-requires-python`

---

## dependencies.H3.5 Проверяй актуальность пакетов
Используй только активные пакеты. Archived и deprecated пакеты не получают обновлений безопасности.
**Почему важно:**
Заброшенные пакеты становятся источником уязвимостей, не исправляются и не поддерживаются.

---

## dependencies.H4.6 Команды проверки deprecated
| Язык | Команда / способ |
|------|------------------|
| JavaScript | `npm view <pkg>` - смотри поле `deprecated` |
| JavaScript | `npm outdated` - deprecated помечаются |
| Python | `pip index versions <pkg>` - смотри warnings |
| Go | `go list -m -versions <module>` + проверь GitHub |
| Rust | `cargo search <crate>` - смотри описание |
| Любой | `gh repo view <owner/repo> --json isArchived` |
**Признаки archived/deprecated:**
- GitHub: плашка "This repository has been archived"
- npm: `npm WARN deprecated <pkg>@<version>: <message>`
- PyPI: статус "Inactive" или явное сообщение в описании
- Нет релизов > 2 лет + нет активности в issues
**Если пакет archived:**
1. Сообщи пользователю
2. Найди активный форк или альтернативу
3. Оцени риск продолжения использования
4. Не устанавливай без явного подтверждения
**Проверка существующих зависимостей:**
```bash
# JavaScript - покажет deprecated
npm outdated
# Проверить конкретный пакет
npm view <package-name> deprecated
```

---

## dependencies.H4.7 Правила обновления версий
| Тип обновления | Действие |
|----------------|----------|
| Patch (0.0.x) | Применять, проверить аудит |
| Minor (0.x.0) | Проверить CHANGELOG, затем применять |
| Major (x.0.0) | Сообщить о breaking changes, дождаться подтверждения |
**При обновлении:**
1. Прочитай CHANGELOG (для minor/major)
2. Проверь breaking changes (для major)
3. Выполни тесты после обновления
4. Выполни аудит

---

## dependencies.H4.8 Чеклист перед установкой/обновлением
Перед любой операцией проверь:
- [ ] Lock-файл существует и в git?
- [ ] Есть ли CRITICAL/HIGH CVE в текущих зависимостях?
- [ ] Peer dependencies удовлетворены?
- [ ] Версия рантайма проекта совместима?
**Если хотя бы один пункт - нет:**
Сначала реши проблему или сообщи пользователю.
