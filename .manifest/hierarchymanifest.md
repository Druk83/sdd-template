# Hierarchy Manifest (H2)

Политики и стандарты иерархии документов проекта (H0-H8), правила подчиненности, трассируемости и разрешения конфликтов.

---

## hierarchy.H3.1 Используй 9-уровневую иерархию H0-H8
Каждый документ проекта относится к одному из 9 уровней: от конституции (H0) до результатов (H8).
**Почему важно:**
Иерархия обеспечивает подчиненность правил, трассируемость требований и разрешение конфликтов.

---

## hierarchy.H4.1 Определение уровней документов
| Уровень | Назначение | Примеры |
|---------|------------|---------|
| H0 | Конституция | `.claude/CLAUDE.md`, `.github\agents\copilot-instructions.md`, `AGENTS.md` |
| H1 | Взгляды (внутри H0) | H1.1-H1.14 в `.claude\CLAUDE.md` или `.github\agents\copilot-instructions.md` или `AGENTS.md` |
| H2 | Манифесты | `.manifest/*.md` |
| H3 | Политики (внутри H2) | Секции манифестов |
| H4 | Стандарты (внутри H2) | Детали манифестов |
| H5 | Спецификации | `.requirements/*.md` |
| H6 | Процедуры (внутри H5) | Этапы в треке |
| H7 | Описание (внутри H5) | Действия внутри этапов |
| H8 | Результаты | `docs/`, `/README.md` |

**Определение по расположению:**
- `.claude/CLAUDE.md`, `.github\agents\copilot-instructions.md`, `AGENTS.md` → H0
- `.manifest/*.md` → H2
- `.requirements/*.md` → H5
- `docs/requirements/*` → H8
- `/README.md` → H8

---

## hierarchy.H4.2 Нумерация правил внутри документов
| Документ | Уровень | Нумерация внутри |
|----------|---------|------------------|
| CLAUDE.md | H0 | H1.1, H1.2 (взгляды) |
| Манифесты | H2 | `<префикс>.H3.X` (политики), `<префикс>.H4.X` (стандарты) |
| Спецификации | H5 | H6.1, H6.2 (процедуры); H7.1, H7.2 (описания) |

**Примеры:**
```
CLAUDE.md: H1.1, H1.2, H1.3
sddmanifest.md: sdd.H3.1, sdd.H4.1
трек разработки.md: H6.1, H7.1
```

---

## hierarchy.H3.2 Применяй принципы ООП к иерархии
Иерархия документов работает по принципам объектно-ориентированного программирования: наследование, инкапсуляция, полиморфизм, chain of responsibility.
**Почему важно:**
Эти принципы делают иерархию предсказуемой и понятной для агентов и разработчиков.

---

## hierarchy.H4.3 Принципы ООП в иерархии
**Наследование:**
- Каждый уровень наследует правила вышестоящих
- H8 содержит все правила от H0 до H7
- Изменение H1 каскадно влияет на все уровни ниже
**Инкапсуляция:**
- Каждый уровень отвечает за свою область
- H2 (манифесты) — правила областей, не процедуры
- H5 (спецификации) — шаблоны, не результаты
- H8 (результаты) — документация, не правила
**Полиморфизм:**
- Одно правило H0 реализуется по-разному на уровнях
- Пример: H1.4 "Верифицировать релевантность" → H3.X "Брать из `.source/`" → H8 документ с терминами из `.source/`
**Chain of Responsibility:**
- При конфликте поднимайся по цепочке H8→H7→...→H0
- Найди правило на вышестоящем уровне

---

## hierarchy.H3.3 Разрешай конфликты по приоритету уровня
При противоречии между правилами на разных уровнях вышестоящий уровень главнее.
**Почему важно:**
Без четкого приоритета невозможно автоматизировать разрешение конфликтов.

---

## hierarchy.H4.4 Правила разрешения конфликтов
**Правило 1: Вышестоящий уровень главнее**
При противоречии: H0 > H1 > H2 > ... > H8
Пример:
- H1.1: "Не использовать эмодзи"
- H5: шаблон содержит эмодзи
- Действие: удалить эмодзи из H5 (подчиняется H1.1)
**Правило 2: Явное правило > неявное**
Внутри одного уровня явное ("Запрещено:") главнее отсутствия упоминания.
Пример:
- H3.1: явно требует остановку после этапа
- H5: молчит об остановке
- Действие: применить явное правило из H3.1
**Правило 3: При отсутствии — подняться выше**
Если на текущем уровне правила нет — ищи на вышестоящем.
Пример:
- H5: не упоминает git workflow
- H1.3: описывает git workflow
- Действие: применить H1.3

---

## hierarchy.H3.4 Трассируй требования от H0 до H8
Любое действие агента должно прослеживаться к конституции (H0/H1).
**Почему важно:**
Трассируемость обеспечивает проверку соответствия результатов исходным правилам.

---

## hierarchy.H4.5 Примеры трассировки
**Пример 1: Запрет эмодзи**
```
H1.1: "НИКОГДА не использовать эмодзи"
 └─ H2: sddmanifest.md (наследует H1.1)
     └─ H5: трек разработки.md (наследует H1.1)
         └─ H6.1: Этап [1] процедура
             └─ H7.1: "Заполнить шаблон"
                 └─ H8: docs/требования.md без эмодзи
```
**Пример 2: Верификация релевантности**
```
H1.4: "Верификация релевантности контексту"
 └─ H3.X: "Не генерировать из обучающих данных"
     └─ H5: предметная область.md раздел "Глоссарий"
         └─ H6.1: Этап [1] процедура
             └─ H7.1: "Брать термины из `.source/`"
                 └─ H8: docs/предметная область.md с терминами из `.source/`
```
**Пример 3: Версионирование**
```
H0: (не регулирует)
 └─ H3.X: "Версия в /README.md"
     └─ H5: трек разработки раздел 9
         └─ H6.1: Этап [1] шаг "Создать README L0"
             └─ H7.X: "Указать версию"
                 └─ H8: /README.md версия 1.3.0
```

---

## hierarchy.H3.5 Разграничивай H и L
Не путай H (иерархия документов) и L (уровни детализации README).
**Почему важно:**
Смешивание приводит к путанице в применении правил.

---

## hierarchy.H4.6 Различие H и L
**H0-H8:** иерархия подчиненности документов проекта
**L0-L2:** уровни детализации README (см. readmemanifest.md)
**README.md на разных H:**
- `/README.md` → H8 (результат этапа [1])
- `.tools/*/README.md` → H7 (описание инструмента)
- `.manifest/README.md` → H2 (правила манифестов)
**Оба обозначения независимы:**
- `/README.md` = H8 + L0 (результат + краткий)
- `.tools/pdd/README.md` = H7 + L2 (описание + технический)

---

## hierarchy.H4.7 Инструкции для агента
**При чтении документа:**
1. Определи уровень H по расположению (hierarchy.H4.1)
2. Запомни номера правил (H1.X, H3.X, H6.X)
3. При конфликте с другим документом — сравни уровни
**При создании документа:**
1. Определи целевой уровень H (куда кладешь результат)
2. Проверь соответствие всем H1-H4 правилам
3. Добавь в начало (если H2/H5): `# <Название> (H2)` или `# <Название> (H5)`
**При обнаружении конфликта:**
1. Определи номера правил (H1.2 vs H3.5)
2. Примени правило приоритета (H1 > H3)
3. Исправь документ с более низким уровнем
4. Сообщи: "Применено H1.2, исправлено H3.5"

---

## hierarchy.H4.8 Чеклист проверки иерархии
Перед коммитом проверь:
- [ ] Все правила имеют H-номера (H1.1, H3.2, H6.5)
- [ ] Нет конфликтов между уровнями
- [ ] Трассируемость H1→H8 сохранена
- [ ] Правила H1-H4 учтены в H5-H8
- [ ] H (иерархия) и L (README) не перепутаны
- [ ] Вышестоящие правила не нарушены нижестоящими
