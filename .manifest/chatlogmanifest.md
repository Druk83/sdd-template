# Chat Log Manifest (H2)

Правила записи и ведения логов сессий чата агента с разработчиком.

---

## chatlog.H3.1 Сохраняй логи только по явному запросу разработчика
Запись логов не выполняется автоматически. Инструмент активируется командой разработчика.
**Триггеры запроса:**
- "сохрани логи", "запиши логи", "обнови логи чата"
- Любая формулировка с явным указанием сохранить историю сессии

---

## chatlog.H4.1 Определи целевой файл лога
Перед записью определи файл назначения.
**Правило именования:**
- Файл по умолчанию: `.chatlog/session.md`
- Если разработчик указал имя явно — использовать его
- Расширение всегда `.md`

---

## chatlog.H3.2 Не дублируй уже записанные обмены
При повторном запросе в той же сессии дополняй файл, а не перезаписывай.
**Почему важно:**
Разработчик может запрашивать сохранение несколько раз за сессию — ранее записанное не должно теряться.

---

## chatlog.H4.2 Используй маркер последней записи
Для определения границы между записанным и новым материалом используй маркер в конце файла.
**Формат маркера:**
```
<!-- last-saved: YYYY-MM-DDTHH:MM -->
```
**Алгоритм при записи:**
1. Прочитать целевой файл.
2. Найти строку `<!-- last-saved: ... -->` — это граница последней записи.
3. Дописать только обмены, произошедшие после маркера.
4. Обновить маркер датой текущей записи.
5. Если файл пуст или не существует — записать всю историю сессии и добавить маркер.

---

## chatlog.H4.3 Соблюдай формат записи обмена
Каждый обмен записывается в строгом формате.
**Формат:**
```markdown
Разработчик:
<текст сообщения разработчика>

---

Агент:
<текст ответа агента>

---
```
**Правила:**
- Разделитель `---` после каждого блока разработчика и агента
- Не включать служебные метаданные IDE (открытые вкладки, путь активного файла)
- Не включать вложения и изображения — только текстовый контент
- Ответ агента записывается кратко: суть действий и результат, без повтора всего тела ответа

---

## chatlog.H3.3 Не записывай чувствительные данные
Логи сессий могут попасть в репозиторий.
**Запрещено записывать:**
- API-ключи, токены, пароли из сообщений
- Пути с именами пользователей машины (заменяй на `<user>`)
- Содержимое `.env` файлов

---

## chatlog.H4.4 Структура директории .chatlog/
```
.chatlog/
  session.md        <- основной файл лога текущей сессии
  <name>.md         <- дополнительные файлы если разработчик указал имя
```
**Файл `.chatlog/session.md` перезаписывается при старте новой сессии** только если разработчик явно попросит создать новый лог. Иначе дополняется.
