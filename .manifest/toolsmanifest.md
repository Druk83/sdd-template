# Tools Manifest (H2)

Политики и стандарты создания инструментов в `.tools/`: регистрация, интерфейс, документация и кросс-платформенность.

---

## tools.H3.1 Регистрируй инструмент в registry.json
Каждый инструмент должен быть зарегистрирован в `.tools/registry.json`.
**Почему важно:**
Без регистрации инструменты невидимы для агентов и автоматизации, их невозможно обнаружить.

---

## tools.H4.1 Формат записи в registry.json
**Формат:**
```json
{
  "name": "tool-name",
  "path": ".tools/<tool>/entry-point",
  "entry": ".tools/<tool>/entry-point --default-args",
  "desc": "Краткое описание (1 строка)",
  "tags": ["tag1", "tag2"],
  "exec": true
}
```
**Обязательные поля:**
| Поле | Назначение |
|------|------------|
| `name` | Уникальное имя для вызова |
| `path` | Путь к исполняемому файлу |
| `desc` | Описание для агента/человека |
| `exec` | `true` если можно запускать |
**Опциональные поля:**
- `entry` - команда запуска с дефолтными аргументами
- `tags` - теги для поиска/фильтрации
- `runtime` - требуемый рантайм (python, node, bash)

---

## tools.H3.2 Реализуй единый интерфейс
Все инструменты следуют единому интерфейсу взаимодействия.
**Почему важно:**
Единый интерфейс обеспечивает предсказуемость, упрощает автоматизацию, снижает порог входа.

---

## tools.H4.2 Требования к интерфейсу
Каждый инструмент должен поддерживать:
- `--help` - вывод справки
- Exit code `0` = успех, `1` = ошибка, `2` = warning
**Вывод:**
- Данные - в stdout
- Диагностика/ошибки - в stderr

---

## tools.H3.3 Документируй в README (L2)
Каждый инструмент имеет документацию L2 уровня.
**Почему важно:**
Без документации инструмент непонятен, невозможно использовать без изучения кода.

---

## tools.H4.3 Структура README инструмента
Создай `.tools/<tool>/README.md` согласно [readmemanifest.md](readmemanifest.md) (раздел readme.H4.6, шаблон readme.H4.10).
**Минимальный шаблон:**
```markdown
# <tool> — <назначение>

<1-2 предложения: что делает>

## Быстрый старт
<команда запуска>

## Опции
* `--flag` — описание

## Входы / Выходы
* Input: <что принимает>
* Output: <что выдает>

## Примеры
<примеры использования>

## Ссылки
* Назад к разделу: `../README.md`
```

---

## tools.H3.4 Не модифицируй файлы без флага
По умолчанию инструмент работает в режиме read-only.
**Почему важно:**
Неожиданная модификация файлов опасна, может привести к потере данных, конфликтам.

---

## tools.H4.4 Правило --write
**Правило:**
- Без `--write` / `--apply` - только анализ/вывод
- С флагом - модификация файлов
**Исключение:**
Инструменты типа `generator` создают новые файлы (не модифицируют существующие).

---

## tools.H3.5 Один инструмент одна цель
Инструмент решает одну конкретную задачу, не комбинирует несколько функций.
**Почему важно:**
Монолитные инструменты сложны в тестировании, поддержке, невозможно комбинировать в pipeline.

---

## tools.H4.5 Примеры правильной декомпозиции
**Правильно:**
- `pdd-scan` - только сканирует @todo
- `create-task` - только создает файл задачи
**Неправильно:**
- `pdd-tool` - сканирует, валидирует, генерирует отчеты, создает задачи (слишком много)
**Почему:**
- Проще тестировать и поддерживать
- Меньше багов при изменениях
- Легче комбинировать в pipeline
**Примечание:**
Теги в `tags` - свободные, для поиска/фильтрации. Жесткой классификации нет.

---

## tools.H3.6 Обеспечь кросс-платформенность
Инструменты обязаны работать на Windows, Linux, macOS.
**Почему важно:**
Проект может использоваться на разных платформах. Платформо-зависимые инструменты ограничивают команду.

---

## tools.H4.6 Требования кросс-платформенности
**Рекомендуемые рантаймы (по приоритету):**
1. Python (стандартная библиотека) - максимальная переносимость
2. Node.js (без npm install) - если уже используется в проекте
3. Bash - только для Linux/macOS; для Windows требуется альтернатива или WSL
**Требования:**
- Пути: использовать `/` или `os.path` / `path.join`, не хардкодить `\`
- Line endings: не зависеть от `\n` vs `\r\n`
- Shebang: `#!/usr/bin/env python3` (не абсолютный путь)
- В README указать: на каких платформах протестировано
**Если кросс-платформенность невозможна:**
- Явно указать в `desc` и README ограничения
- Добавить тег `platform:linux` / `platform:windows` в registry.json

---

## tools.H4.7 Минимизируй внешние зависимости
**Предпочтения:**
1. Стандартная библиотека рантайма
2. Встроенные утилиты OS (с учетом кросс-платформенности)
3. Внешние пакеты - только если без них никак
**Если зависимости необходимы:**
- Укажи в README секцию "Зависимости"
- Добавь `requirements.txt` / `package.json` в папку инструмента

---

## tools.H4.8 Используй стандартные форматы вывода
| Формат | Когда использовать |
|--------|-------------------|
| JSON | Машинное чтение pipe в другой инструмент |
| Markdown | Отчеты для людей запись в `.tasks/` |
| Plain text | Простые результаты логи |
Если инструмент поддерживает несколько форматов - используй `--format <json|md|text>`.

---

## tools.H4.9 Правила для агента
**Перед вызовом инструмента:**
- Прочитай `.tools/registry.json`
- Проверь что инструмент существует (`exec: true`)
- Используй `--help` если не уверен в опциях
**При создании нового инструмента:**
- Проверь нет ли существующего с похожим функционалом
- Добавь запись в `registry.json`
- Создай README в `.tools/<tool>/README.md`
- Не делай commit/push
**Запрещено:**
- Вызывать инструменты не из registry
- Создавать инструмент без регистрации
- Запускать с `--write` без явного запроса пользователя

---

## tools.H4.10 Чеклист готовности инструмента
Инструмент готов если:
- [ ] Зарегистрирован в `registry.json`
- [ ] Есть `--help`
- [ ] Есть README (L2) с примерами
- [ ] Exit codes: 0/1/2
- [ ] Без `--write` не модифицирует файлы
- [ ] Кросс-платформенность проверена
