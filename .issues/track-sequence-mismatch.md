# Несоответствие трека разработки диаграмме последовательности событий

**Type:** `type:doc`
**Priority:** `priority:P1`
**Severity:** `severity:S2`
**Status:** `status:done`

## Контекст
- Компонент: `.requirements/трек разработки.md` (H5)
- Эталон: `.diagrams\последовательность событий.plantuml`
- Impact: агент может пропустить важные шаги при выполнении SDD

## Описание проблемы
Трек разработки (H5) не полностью соответствует идеальной последовательности событий из диаграммы. Обнаружены расхождения в структуре и детализации.

## Ожидаемое поведение
Трек разработки должен отражать все элементы диаграммы последовательности: ПОДГОТОВКА, все подэтапы, ФИНАЛ, альтернативные пути.

## Фактическое поведение
Трек разработки пропускает критические секции и объединяет подэтапы без детализации.

---

## Перечень расхождений

### GAP-1: Нет секции ПОДГОТОВКА
**Priority:** P1 | **Severity:** S1

**В диаграмме:**
```
== ПОДГОТОВКА ==
Agent -> Source: Читает ВСЕ файлы
Agent -> Manifest: Читает H0, H1, H2 манифесты (sddmanifest, gapmanifest, diagramsmanifest, versionmanifest)
Agent -> Templates: Читает трек разработки.md (H5)
Agent -> Approach: Читает registry.json
```

**В треке:** секция отсутствует

**Решение:** добавить секцию "## 1.5 Подготовка" или "## 0.5 Фаза подготовки"

---

### GAP-2: Этап [4] - пропущен подход ddd-patterns.md
**Priority:** P2 | **Severity:** S3

**В диаграмме:**
```
Agent -> Approach: Читает ddd-patterns.md
```

**В треке:** нет строки `**Подходы:**` для этапа [4]

**Решение:** добавить `**Подходы:** .approach/ddd-patterns.md` в секцию этапа [4]

---

### GAP-3: Подэтапы [5.1], [5.2], [5.3] объединены
**Priority:** P2 | **Severity:** S2

**В диаграмме:** отдельные `group` для каждого подэтапа с 4 фазами

**В треке:** только общее описание [5] + отдельно [5.4]

**Решение:** добавить отдельные секции для [5.1], [5.2], [5.3] аналогично [5.4]

---

### GAP-4: Подэтапы [7 BL], [7 AL], [7 TL] объединены
**Priority:** P2 | **Severity:** S2

**В диаграмме:** отдельные `group` для каждого слоя с 4 фазами и точками подтверждения

**В треке:** только общее описание [7] + отдельно [7.1]

**Решение:** добавить отдельные секции для [7 BL], [7 AL], [7 TL] аналогично [7.1]

---

### GAP-5: Нет секции ФИНАЛ
**Priority:** P1 | **Severity:** S1

**В диаграмме:**
```
== ФИНАЛ ==
Agent -> Docs: Проверяет gap-tracking.md
Agent -> Manifest: Проверяет versionmanifest.md
alt Есть открытые GAP
    loop По каждому GAP
        Dev -> Agent: "Закрыть GAP N: <решение>"
        Agent -> Docs: Закрывает GAP
    end
else Все GAP закрыты
    Agent --> Dev: "Документация полностью завершена."
end
Agent -> Docs: Обновляет версию в README.md
```

**В треке:** секция отсутствует

**Решение:** добавить секцию "## 3.10 ФИНАЛ" после этапа [9]

---

### GAP-6: Рендеринг диаграмм не детализирован
**Priority:** P3 | **Severity:** S3

**В диаграмме:** явные блоки рендеринга для [5.4] и [7.1] с альтернативными путями при ошибках

**В треке:** только упоминание PNG в выходах

**Решение:** добавить описание процесса рендеринга в секции [5.4] и [7.1]

---

### GAP-7: Альтернативные пути не описаны
**Priority:** P2 | **Severity:** S2

**В диаграмме:** `alt` блоки для каждого этапа:
- "Есть неясности" vs "Все ясно"
- "Принято" vs "Требуется доработка"
- "Рендеринг успешен" vs "Ошибка рендеринга"

**В треке:** нет описания действий при ошибках/доработках

**Решение:** добавить описание альтернативных путей в секцию "## 2. Идеальная модель выполнения этапа"

---

## План исправления

- [x] GAP-1: Добавить секцию ПОДГОТОВКА (уже была в строках 107-110)
- [x] GAP-2: Добавить подход для [4] (добавлено `.approach/ddd-patterns.md`)
- [x] GAP-3: Детализировать [5.1], [5.2], [5.3] (уже были в строках 149-166)
- [x] GAP-4: Детализировать [7 BL], [7 AL], [7 TL] (уже были в строках 193-209)
- [x] GAP-5: Добавить секцию ФИНАЛ (уже была в строках 236-239)
- [x] GAP-6: Детализировать рендеринг (уже было в строках 172-178, 216-222)
- [x] GAP-7: Добавить альтернативные пути (уже были в строках 80-83)

## Дополнительные изменения

- Добавлены новые подходы в условные ветви (строки 85-91):
  - `.approach/pub-sub.md` для [5.2]
  - `.approach/cqrs.md` для [6], [7]
  - `.approach/event-sourcing.md` для [6]
- Обновлены подходы в детализации этапов:
  - Этап [4]: добавлено `.approach/ddd-patterns.md`
  - Этап [5.2]: добавлено `.approach/pub-sub.md`
  - Этап [6]: добавлены `.approach/cqrs.md`, `.approach/event-sourcing.md`
  - Этап [7]: добавлены `.approach/cqrs.md`, `.approach/pub-sub.md`, архитектурный паттерн из arch-patterns

## Связи
- Эталон: `.diagrams\последовательность событий.plantuml`
- Целевой файл: `.requirements/трек разработки.md`
